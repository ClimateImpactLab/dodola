
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../repository/">
      
      
        <link rel="next" href="../changelog/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>dodola.services - dodola Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.618322db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dodola.services.adjust_maximum_precipitation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="dodola Documentation" class="md-header__button md-logo" aria-label="dodola Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            dodola Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              dodola.services
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/climateimpactlab/dodola" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="dodola Documentation" class="md-nav__button md-logo" aria-label="dodola Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    dodola Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/climateimpactlab/dodola" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    dodola.cli
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    dodola.core
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../repository/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    dodola.repository
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    dodola.services
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    dodola.services
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dodola.services.adjust_maximum_precipitation" class="md-nav__link">
    <span class="md-ellipsis">
      
        adjust_maximum_precipitation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.apply_dtr_floor" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_dtr_floor
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.apply_non_polar_dtr_ceiling" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_non_polar_dtr_ceiling
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.apply_qdm" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_qdm
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.apply_qplad" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_qplad
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.clean_cmip6" class="md-nav__link">
    <span class="md-ellipsis">
      
        clean_cmip6
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.correct_wet_day_frequency" class="md-nav__link">
    <span class="md-ellipsis">
      
        correct_wet_day_frequency
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.get_attrs" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_attrs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.log_service" class="md-nav__link">
    <span class="md-ellipsis">
      
        log_service
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.prime_qdm_output_zarrstore" class="md-nav__link">
    <span class="md-ellipsis">
      
        prime_qdm_output_zarrstore
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.prime_qplad_output_zarrstore" class="md-nav__link">
    <span class="md-ellipsis">
      
        prime_qplad_output_zarrstore
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.rechunk" class="md-nav__link">
    <span class="md-ellipsis">
      
        rechunk
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.regrid" class="md-nav__link">
    <span class="md-ellipsis">
      
        regrid
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.remove_leapdays" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_leapdays
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.train_qdm" class="md-nav__link">
    <span class="md-ellipsis">
      
        train_qdm
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.train_qplad" class="md-nav__link">
    <span class="md-ellipsis">
      
        train_qplad
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.validate" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dodola.services.adjust_maximum_precipitation" class="md-nav__link">
    <span class="md-ellipsis">
      
        adjust_maximum_precipitation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.apply_dtr_floor" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_dtr_floor
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.apply_non_polar_dtr_ceiling" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_non_polar_dtr_ceiling
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.apply_qdm" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_qdm
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.apply_qplad" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_qplad
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.clean_cmip6" class="md-nav__link">
    <span class="md-ellipsis">
      
        clean_cmip6
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.correct_wet_day_frequency" class="md-nav__link">
    <span class="md-ellipsis">
      
        correct_wet_day_frequency
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.get_attrs" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_attrs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.log_service" class="md-nav__link">
    <span class="md-ellipsis">
      
        log_service
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.prime_qdm_output_zarrstore" class="md-nav__link">
    <span class="md-ellipsis">
      
        prime_qdm_output_zarrstore
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.prime_qplad_output_zarrstore" class="md-nav__link">
    <span class="md-ellipsis">
      
        prime_qplad_output_zarrstore
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.rechunk" class="md-nav__link">
    <span class="md-ellipsis">
      
        rechunk
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.regrid" class="md-nav__link">
    <span class="md-ellipsis">
      
        regrid
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.remove_leapdays" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_leapdays
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.train_qdm" class="md-nav__link">
    <span class="md-ellipsis">
      
        train_qdm
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.train_qplad" class="md-nav__link">
    <span class="md-ellipsis">
      
        train_qplad
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.services.validate" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>dodola.services</h1>

<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">

        <p>Used by the CLI or any UI to deliver services to our lovely users</p>












<p><span class="doc-section-title">Functions:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.services.adjust_maximum_precipitation" href="#dodola.services.adjust_maximum_precipitation">adjust_maximum_precipitation</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Adjusts maximum precipitation in a dataset</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.services.apply_dtr_floor" href="#dodola.services.apply_dtr_floor">apply_dtr_floor</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Applies a floor to diurnal temperature range (DTR) values</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.services.apply_non_polar_dtr_ceiling" href="#dodola.services.apply_non_polar_dtr_ceiling">apply_non_polar_dtr_ceiling</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Applies a ceiling to diurnal temperature range (DTR) values</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.services.apply_qdm" href="#dodola.services.apply_qdm">apply_qdm</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Apply trained QDM to adjust a years in a simulation, write to Zarr Store.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.services.apply_qplad" href="#dodola.services.apply_qplad">apply_qplad</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Apply QPLAD adjustment factors to downscale a simulation, dump to NetCDF.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.services.clean_cmip6" href="#dodola.services.clean_cmip6">clean_cmip6</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Cleans and standardizes CMIP6 GCM</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.services.correct_wet_day_frequency" href="#dodola.services.correct_wet_day_frequency">correct_wet_day_frequency</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Corrects wet day frequency in a dataset</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.services.get_attrs" href="#dodola.services.get_attrs">get_attrs</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Get JSON str of <code>x</code> attrs metadata.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.services.log_service" href="#dodola.services.log_service">log_service</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Decorator for dodola.services to log service start and stop</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.services.prime_qdm_output_zarrstore" href="#dodola.services.prime_qdm_output_zarrstore">prime_qdm_output_zarrstore</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Init a Zarr Store for writing QDM output regionally in independent processes.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.services.prime_qplad_output_zarrstore" href="#dodola.services.prime_qplad_output_zarrstore">prime_qplad_output_zarrstore</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Init a Zarr Store for writing QPLAD output regionally in independent processes.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.services.rechunk" href="#dodola.services.rechunk">rechunk</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Rechunk data to specification</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.services.regrid" href="#dodola.services.regrid">regrid</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Regrid climate data</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.services.remove_leapdays" href="#dodola.services.remove_leapdays">remove_leapdays</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Removes leap days and updates calendar attribute</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.services.train_qdm" href="#dodola.services.train_qdm">train_qdm</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Train quantile delta mapping and dump to <code>out</code></p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.services.train_qplad" href="#dodola.services.train_qplad">train_qplad</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Train Quantile-Preserving, Localized Analogs Downscaling and dump to <code>out</code></p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.services.validate" href="#dodola.services.validate">validate</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Performs validation on an input dataset</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="dodola.services.adjust_maximum_precipitation" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.services.adjust_maximum_precipitation</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">adjust_maximum_precipitation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">3000.0</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Adjusts maximum precipitation in a dataset</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Storage URL to input xr.Dataset that will be corrected.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Storage URL to write corrected output to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>threshold</code>
            </td>
            <td>
                  <code><span title="int">int</span> or <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>All precipitation values lower than this value are corrected to the threshold value.</p>
              </div>
            </td>
            <td>
                  <code>3000.0</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>dodola/services.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@log_service</span>
<span class="k">def</span><span class="w"> </span><span class="nf">adjust_maximum_precipitation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">3000.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adjusts maximum precipitation in a dataset</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : str</span>
<span class="sd">        Storage URL to input xr.Dataset that will be corrected.</span>
<span class="sd">    out : str</span>
<span class="sd">        Storage URL to write corrected output to.</span>
<span class="sd">    threshold : int or float, optional</span>
<span class="sd">        All precipitation values lower than this value are corrected to the threshold value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ds</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ds_corrected</span> <span class="o">=</span> <span class="n">apply_precip_ceiling</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>
    <span class="n">storage</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">ds_corrected</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.services.apply_dtr_floor" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.services.apply_dtr_floor</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">apply_dtr_floor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">floor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Applies a floor to diurnal temperature range (DTR) values</p>
<p>This constrains the values in a DTR dataset by applying a floor. The floor is assigned to the value of the
data points which have their value strictly below the floor.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Storage URL to input xr.Dataset that will be corrected.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Storage URL to write corrected output to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>floor</code>
            </td>
            <td>
                  <code><span title="int">int</span> or <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>All DTR values lower than this value are corrected to that value.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>dodola/services.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@log_service</span>
<span class="k">def</span><span class="w"> </span><span class="nf">apply_dtr_floor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">floor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Applies a floor to diurnal temperature range (DTR) values</span>

<span class="sd">    This constrains the values in a DTR dataset by applying a floor. The floor is assigned to the value of the</span>
<span class="sd">    data points which have their value strictly below the floor.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : str</span>
<span class="sd">        Storage URL to input xr.Dataset that will be corrected.</span>
<span class="sd">    out : str</span>
<span class="sd">        Storage URL to write corrected output to.</span>
<span class="sd">    floor : int or float, optional</span>
<span class="sd">        All DTR values lower than this value are corrected to that value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">dtr_floor</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">floor</span><span class="p">)</span>
    <span class="n">storage</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">ds</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.services.apply_non_polar_dtr_ceiling" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.services.apply_non_polar_dtr_ceiling</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">apply_non_polar_dtr_ceiling</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">ceiling</span><span class="o">=</span><span class="mf">70.0</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Applies a ceiling to diurnal temperature range (DTR) values</p>
<p>This constrains the values in a DTR dataset by applying a ceiling. The ceiling is assigned to the value of the
data points which have their value strictly above the ceiling.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Storage URL to input xr.Dataset that will be corrected.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Storage URL to write corrected output to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ceiling</code>
            </td>
            <td>
                  <code><span title="int">int</span> or <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>All DTR values above this value are corrected to that value.</p>
              </div>
            </td>
            <td>
                  <code>70.0</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>dodola/services.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@log_service</span>
<span class="k">def</span><span class="w"> </span><span class="nf">apply_non_polar_dtr_ceiling</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">ceiling</span><span class="o">=</span><span class="mf">70.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Applies a ceiling to diurnal temperature range (DTR) values</span>

<span class="sd">    This constrains the values in a DTR dataset by applying a ceiling. The ceiling is assigned to the value of the</span>
<span class="sd">    data points which have their value strictly above the ceiling.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : str</span>
<span class="sd">        Storage URL to input xr.Dataset that will be corrected.</span>
<span class="sd">    out : str</span>
<span class="sd">        Storage URL to write corrected output to.</span>
<span class="sd">    ceiling : int or float, optional</span>
<span class="sd">        All DTR values above this value are corrected to that value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">non_polar_dtr_ceiling</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ceiling</span><span class="p">)</span>
    <span class="n">storage</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">ds</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.services.apply_qdm" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.services.apply_qdm</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">apply_qdm</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">qdm</span><span class="p">,</span> <span class="n">years</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">sel_slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">isel_slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">out_zarr_region</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">root_attrs_json_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">new_attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Apply trained QDM to adjust a years in a simulation, write to Zarr Store.</p>
<p>Output includes bias-corrected variable <code>variable</code> as well as a variable giving quantiles
from the QDM, "sim_q".</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>simulation</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fsspec-compatible URL containing simulation data to be adjusted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>qdm</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fsspec-compatible URL pointing to Zarr Store containing canned
<code>xclim.sdba.adjustment.QuantileDeltaMapping</code> Dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>years</code>
            </td>
            <td>
                  <code>sequence of ints</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Years of simulation to adjust, with rolling years and day grouping.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>variable</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target variable in <code>simulation</code> to adjust. Adjusted output will share the
same name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fsspec-compatible path or URL pointing to Zarr Store file where the
QDM-adjusted simulation data will be written.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sel_slice</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Label-index slice input slimulation dataset before adjusting.
A mapping of {variable_name: slice(...)} passed to
<code>xarray.Dataset.sel()</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>isel_slice</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Integer-index slice input slimulation dataset before adjusting. A mapping
of {variable_name: slice(...)} passed to <code>xarray.Dataset.isel()</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out_zarr_region</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A mapping of {variable_name: slice(...)} giving the region to write
to if outputting to existing Zarr Store.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>root_attrs_json_file</code>
            </td>
            <td>
                  <code><span title="str">str</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fsspec-compatible URL pointing to a JSON file to use as root <code>attrs</code>
for the output data. <code>new_attrs</code> will be appended to this.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_attrs</code>
            </td>
            <td>
                  <code><span title="dict">dict</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict to merge with output Dataset's root <code>attrs</code> before output.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>dodola/services.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@log_service</span>
<span class="k">def</span><span class="w"> </span><span class="nf">apply_qdm</span><span class="p">(</span>
    <span class="n">simulation</span><span class="p">,</span>
    <span class="n">qdm</span><span class="p">,</span>
    <span class="n">years</span><span class="p">,</span>
    <span class="n">variable</span><span class="p">,</span>
    <span class="n">out</span><span class="p">,</span>
    <span class="n">sel_slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">isel_slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">out_zarr_region</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">root_attrs_json_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">new_attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply trained QDM to adjust a years in a simulation, write to Zarr Store.</span>

<span class="sd">    Output includes bias-corrected variable `variable` as well as a variable giving quantiles</span>
<span class="sd">    from the QDM, &quot;sim_q&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    simulation : str</span>
<span class="sd">        fsspec-compatible URL containing simulation data to be adjusted.</span>
<span class="sd">    qdm : str</span>
<span class="sd">        fsspec-compatible URL pointing to Zarr Store containing canned</span>
<span class="sd">        ``xclim.sdba.adjustment.QuantileDeltaMapping`` Dataset.</span>
<span class="sd">    years : sequence of ints</span>
<span class="sd">        Years of simulation to adjust, with rolling years and day grouping.</span>
<span class="sd">    variable : str</span>
<span class="sd">        Target variable in `simulation` to adjust. Adjusted output will share the</span>
<span class="sd">        same name.</span>
<span class="sd">    out : str</span>
<span class="sd">        fsspec-compatible path or URL pointing to Zarr Store file where the</span>
<span class="sd">        QDM-adjusted simulation data will be written.</span>
<span class="sd">    sel_slice: dict or None, optional</span>
<span class="sd">        Label-index slice input slimulation dataset before adjusting.</span>
<span class="sd">        A mapping of {variable_name: slice(...)} passed to</span>
<span class="sd">        `xarray.Dataset.sel()`.</span>
<span class="sd">    isel_slice: dict or None, optional</span>
<span class="sd">        Integer-index slice input slimulation dataset before adjusting. A mapping</span>
<span class="sd">        of {variable_name: slice(...)} passed to `xarray.Dataset.isel()`.</span>
<span class="sd">    out_zarr_region: dict or None, optional</span>
<span class="sd">        A mapping of {variable_name: slice(...)} giving the region to write</span>
<span class="sd">        to if outputting to existing Zarr Store.</span>
<span class="sd">    root_attrs_json_file : str or None, optional</span>
<span class="sd">        fsspec-compatible URL pointing to a JSON file to use as root ``attrs``</span>
<span class="sd">        for the output data. ``new_attrs`` will be appended to this.</span>
<span class="sd">    new_attrs : dict or None, optional</span>
<span class="sd">        dict to merge with output Dataset&#39;s root ``attrs`` before output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sim_ds</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
    <span class="n">qdm_ds</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">qdm</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">root_attrs_json_file</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using root attrs from </span><span class="si">{</span><span class="n">root_attrs_json_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sim_ds</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read_attrs</span><span class="p">(</span><span class="n">root_attrs_json_file</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sel_slice</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Slicing by </span><span class="si">{</span><span class="n">sel_slice</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sim_ds</span> <span class="o">=</span> <span class="n">sim_ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">sel_slice</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">isel_slice</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Slicing by </span><span class="si">{</span><span class="n">isel_slice</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sim_ds</span> <span class="o">=</span> <span class="n">sim_ds</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">isel_slice</span><span class="p">)</span>

    <span class="n">variable</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>

    <span class="n">qdm_ds</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
    <span class="n">sim_ds</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

    <span class="n">sim_ds</span> <span class="o">=</span> <span class="n">xclim_units_any2pint</span><span class="p">(</span><span class="n">sim_ds</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>

    <span class="n">adjusted_ds</span> <span class="o">=</span> <span class="n">adjust_quantiledeltamapping</span><span class="p">(</span>
        <span class="n">simulation</span><span class="o">=</span><span class="n">sim_ds</span><span class="p">,</span>
        <span class="n">variable</span><span class="o">=</span><span class="n">variable</span><span class="p">,</span>
        <span class="n">qdm</span><span class="o">=</span><span class="n">qdm_ds</span><span class="p">,</span>
        <span class="n">years</span><span class="o">=</span><span class="n">years</span><span class="p">,</span>
        <span class="n">astype</span><span class="o">=</span><span class="n">sim_ds</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
        <span class="n">include_quantiles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">adjusted_ds</span> <span class="o">=</span> <span class="n">xclim_units_pint2cf</span><span class="p">(</span><span class="n">adjusted_ds</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">new_attrs</span><span class="p">:</span>
        <span class="n">adjusted_ds</span><span class="o">.</span><span class="n">attrs</span> <span class="o">|=</span> <span class="n">new_attrs</span>

    <span class="n">storage</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">adjusted_ds</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">out_zarr_region</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.services.apply_qplad" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.services.apply_qplad</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">apply_qplad</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">qplad</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">sel_slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">isel_slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">out_zarr_region</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">root_attrs_json_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">new_attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wet_day_post_correction</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Apply QPLAD adjustment factors to downscale a simulation, dump to NetCDF.</p>
<p>Dumping to NetCDF is a feature likely to change in the near future.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>simulation</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fsspec-compatible URL containing simulation data to be adjusted.
Dataset must have <code>variable</code> as well as a variable, "sim_q", giving
the quantiles from QDM bias adjustment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>qplad</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fsspec-compatible URL pointing to Zarr Store containing canned
<code>xclim.sdba.adjustment.AnalogQuantilePreservingDownscaling</code> Dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>variable</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target variable in <code>simulation</code> to downscale. Downscaled output will share the
same name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fsspec-compatible path or URL pointing to Zarr Store where the
QPLAD-downscaled simulation data will be written.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sel_slice</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Label-index slice input slimulation dataset before adjusting.
A mapping of {variable_name: slice(...)} passed to
<code>xarray.Dataset.sel()</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>isel_slice</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Integer-index slice input slimulation dataset before adjusting. A mapping
of {variable_name: slice(...)} passed to <code>xarray.Dataset.isel()</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out_zarr_region</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A mapping of {variable_name: slice(...)} giving the region to write
to if outputting to existing Zarr Store.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>root_attrs_json_file</code>
            </td>
            <td>
                  <code><span title="str">str</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fsspec-compatible URL pointing to a JSON file to use as root <code>attrs</code>
for the output data. <code>new_attrs</code> will be appended to this.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_attrs</code>
            </td>
            <td>
                  <code><span title="dict">dict</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict to merge with output Dataset's root <code>attrs</code> before output.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wet_day_post_correction</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to apply wet day frequency correction on downscaled data</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>dodola/services.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@log_service</span>
<span class="k">def</span><span class="w"> </span><span class="nf">apply_qplad</span><span class="p">(</span>
    <span class="n">simulation</span><span class="p">,</span>
    <span class="n">qplad</span><span class="p">,</span>
    <span class="n">variable</span><span class="p">,</span>
    <span class="n">out</span><span class="p">,</span>
    <span class="n">sel_slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">isel_slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">out_zarr_region</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">root_attrs_json_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">new_attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">wet_day_post_correction</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply QPLAD adjustment factors to downscale a simulation, dump to NetCDF.</span>

<span class="sd">    Dumping to NetCDF is a feature likely to change in the near future.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    simulation : str</span>
<span class="sd">        fsspec-compatible URL containing simulation data to be adjusted.</span>
<span class="sd">        Dataset must have `variable` as well as a variable, &quot;sim_q&quot;, giving</span>
<span class="sd">        the quantiles from QDM bias adjustment.</span>
<span class="sd">    qplad : str</span>
<span class="sd">        fsspec-compatible URL pointing to Zarr Store containing canned</span>
<span class="sd">        ``xclim.sdba.adjustment.AnalogQuantilePreservingDownscaling`` Dataset.</span>
<span class="sd">    variable : str</span>
<span class="sd">        Target variable in `simulation` to downscale. Downscaled output will share the</span>
<span class="sd">        same name.</span>
<span class="sd">    out : str</span>
<span class="sd">        fsspec-compatible path or URL pointing to Zarr Store where the</span>
<span class="sd">        QPLAD-downscaled simulation data will be written.</span>
<span class="sd">    sel_slice: dict or None, optional</span>
<span class="sd">        Label-index slice input slimulation dataset before adjusting.</span>
<span class="sd">        A mapping of {variable_name: slice(...)} passed to</span>
<span class="sd">        `xarray.Dataset.sel()`.</span>
<span class="sd">    isel_slice: dict or None, optional</span>
<span class="sd">        Integer-index slice input slimulation dataset before adjusting. A mapping</span>
<span class="sd">        of {variable_name: slice(...)} passed to `xarray.Dataset.isel()`.</span>
<span class="sd">    out_zarr_region: dict or None, optional</span>
<span class="sd">        A mapping of {variable_name: slice(...)} giving the region to write</span>
<span class="sd">        to if outputting to existing Zarr Store.</span>
<span class="sd">    root_attrs_json_file : str or None, optional</span>
<span class="sd">        fsspec-compatible URL pointing to a JSON file to use as root ``attrs``</span>
<span class="sd">        for the output data. ``new_attrs`` will be appended to this.</span>
<span class="sd">    new_attrs : dict or None, optional</span>
<span class="sd">        dict to merge with output Dataset&#39;s root ``attrs`` before output.</span>
<span class="sd">    wet_day_post_correction : bool</span>
<span class="sd">        Whether to apply wet day frequency correction on downscaled data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sim_ds</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
    <span class="n">qplad_ds</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">qplad</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">root_attrs_json_file</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using root attrs from </span><span class="si">{</span><span class="n">root_attrs_json_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sim_ds</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read_attrs</span><span class="p">(</span><span class="n">root_attrs_json_file</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sel_slice</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Slicing by </span><span class="si">{</span><span class="n">sel_slice</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sim_ds</span> <span class="o">=</span> <span class="n">sim_ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">sel_slice</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">isel_slice</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Slicing by </span><span class="si">{</span><span class="n">isel_slice</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sim_ds</span> <span class="o">=</span> <span class="n">sim_ds</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">isel_slice</span><span class="p">)</span>

    <span class="n">sim_ds</span> <span class="o">=</span> <span class="n">sim_ds</span><span class="o">.</span><span class="n">set_coords</span><span class="p">([</span><span class="s2">&quot;sim_q&quot;</span><span class="p">])</span>

    <span class="c1"># needs to not be chunked</span>
    <span class="n">sim_ds</span> <span class="o">=</span> <span class="n">sim_ds</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
    <span class="n">qplad_ds</span> <span class="o">=</span> <span class="n">qplad_ds</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

    <span class="n">variable</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>

    <span class="n">sim_ds</span> <span class="o">=</span> <span class="n">xclim_units_any2pint</span><span class="p">(</span><span class="n">sim_ds</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">qplad_ds</span><span class="p">:</span>
        <span class="n">qplad_ds</span> <span class="o">=</span> <span class="n">xclim_units_any2pint</span><span class="p">(</span><span class="n">qplad_ds</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>

    <span class="n">adjusted_ds</span> <span class="o">=</span> <span class="n">adjust_analogdownscaling</span><span class="p">(</span>
        <span class="n">simulation</span><span class="o">=</span><span class="n">sim_ds</span><span class="p">,</span> <span class="n">qplad</span><span class="o">=</span><span class="n">qplad_ds</span><span class="p">,</span> <span class="n">variable</span><span class="o">=</span><span class="n">variable</span>
    <span class="p">)</span>

    <span class="c1"># no need to revert units change. adjust_analogdownscaling does it</span>

    <span class="k">if</span> <span class="n">wet_day_post_correction</span><span class="p">:</span>
        <span class="n">adjusted_ds</span> <span class="o">=</span> <span class="n">apply_wet_day_frequency_correction</span><span class="p">(</span><span class="n">adjusted_ds</span><span class="p">,</span> <span class="s2">&quot;post&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">new_attrs</span><span class="p">:</span>
        <span class="n">adjusted_ds</span><span class="o">.</span><span class="n">attrs</span> <span class="o">|=</span> <span class="n">new_attrs</span>

    <span class="n">storage</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">adjusted_ds</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">out_zarr_region</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.services.clean_cmip6" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.services.clean_cmip6</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">clean_cmip6</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">leapday_removal</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Cleans and standardizes CMIP6 GCM</p>
<p>This loads the entire <code>x</code> Dataset into memory for speed
and to avoid chunking errors.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Storage URL to input xr.Dataset that will be cleaned.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Storage URL to write cleaned GCM output to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>leapday_removal</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to remove leap days.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>dodola/services.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@log_service</span>
<span class="k">def</span><span class="w"> </span><span class="nf">clean_cmip6</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">leapday_removal</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Cleans and standardizes CMIP6 GCM</span>

<span class="sd">    This loads the entire `x` Dataset into memory for speed</span>
<span class="sd">    and to avoid chunking errors.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : str</span>
<span class="sd">        Storage URL to input xr.Dataset that will be cleaned.</span>
<span class="sd">    out : str</span>
<span class="sd">        Storage URL to write cleaned GCM output to.</span>
<span class="sd">    leapday_removal : bool</span>
<span class="sd">        Whether or not to remove leap days.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">cleaned_ds</span> <span class="o">=</span> <span class="n">standardize_gcm</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">leapday_removal</span><span class="p">)</span>
    <span class="n">storage</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">cleaned_ds</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.services.correct_wet_day_frequency" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.services.correct_wet_day_frequency</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">correct_wet_day_frequency</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">variable</span><span class="o">=</span><span class="s1">&#39;pr&#39;</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Corrects wet day frequency in a dataset</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Storage URL to input xr.Dataset that will be regridded.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Storage URL to write regridded output to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>process</code>
            </td>
            <td>
                  <code>(<span title="pre">pre</span>, <span title="post">post</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Step in pipeline, used in determining how to correct.
"Pre" replaces all zero values with a uniform random value below a threshold (before bias adjustment).
"Post" replaces all values below a threshold with zeroes (after bias adjustment).</p>
              </div>
            </td>
            <td>
                  <code>&#34;pre&#34;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>variable</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>&#39;pr&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>dodola/services.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@log_service</span>
<span class="k">def</span><span class="w"> </span><span class="nf">correct_wet_day_frequency</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">variable</span><span class="o">=</span><span class="s2">&quot;pr&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Corrects wet day frequency in a dataset</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : str</span>
<span class="sd">        Storage URL to input xr.Dataset that will be regridded.</span>
<span class="sd">    out : str</span>
<span class="sd">        Storage URL to write regridded output to.</span>
<span class="sd">    process : {&quot;pre&quot;, &quot;post&quot;}</span>
<span class="sd">        Step in pipeline, used in determining how to correct.</span>
<span class="sd">        &quot;Pre&quot; replaces all zero values with a uniform random value below a threshold (before bias adjustment).</span>
<span class="sd">        &quot;Post&quot; replaces all values below a threshold with zeroes (after bias adjustment).</span>
<span class="sd">    variable: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ds_corrected</span> <span class="o">=</span> <span class="n">apply_wet_day_frequency_correction</span><span class="p">(</span>
        <span class="n">ds</span><span class="p">,</span> <span class="n">process</span><span class="o">=</span><span class="n">process</span><span class="p">,</span> <span class="n">variable</span><span class="o">=</span><span class="n">variable</span>
    <span class="p">)</span>
    <span class="n">storage</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">ds_corrected</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.services.get_attrs" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.services.get_attrs</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_attrs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">variable</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get JSON str of <code>x</code> attrs metadata.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>dodola/services.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_attrs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">variable</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get JSON str of `x` attrs metadata.&quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">variable</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.services.log_service" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.services.log_service</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">log_service</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Decorator for dodola.services to log service start and stop</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>dodola/services.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">log_service</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator for dodola.services to log service start and stop&quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">service_logger</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">servicename</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting dodola service </span><span class="si">{</span><span class="n">servicename</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">args</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">kwargs</span><span class="si">=}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dodola service </span><span class="si">{</span><span class="n">servicename</span><span class="si">}</span><span class="s2"> done&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">service_logger</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.services.prime_qdm_output_zarrstore" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.services.prime_qdm_output_zarrstore</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">prime_qdm_output_zarrstore</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">years</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">zarr_region_dims</span><span class="p">,</span> <span class="n">root_attrs_json_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">new_attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Init a Zarr Store for writing QDM output regionally in independent processes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>simulation</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fsspec-compatible URL containing simulation data to be adjusted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>variable</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target variable in <code>simulation</code> to adjust. Adjusted output will share the
same name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>years</code>
            </td>
            <td>
                  <code>sequence of ints</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Years of simulation to adjust, with rolling years and day grouping.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fsspec-compatible path or URL pointing to Zarr Store file where the
QDM-adjusted simulation data will be written.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>zarr_region_dims</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sequence giving the name of dimensions that will be used to later write
to regions of the Zarr Store. Variables with dimensions that do not use
these regional variables will be appended to the primed Zarr Store as
part of this call.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>root_attrs_json_file</code>
            </td>
            <td>
                  <code><span title="str">str</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fsspec-compatible URL pointing to a JSON file to use as root <code>attrs</code>
for the output data. <code>new_attrs</code> will be appended to this.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_attrs</code>
            </td>
            <td>
                  <code><span title="dict">dict</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict to merge with output Dataset's root <code>attrs</code> before output.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>dodola/services.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@log_service</span>
<span class="k">def</span><span class="w"> </span><span class="nf">prime_qdm_output_zarrstore</span><span class="p">(</span>
    <span class="n">simulation</span><span class="p">,</span>
    <span class="n">variable</span><span class="p">,</span>
    <span class="n">years</span><span class="p">,</span>
    <span class="n">out</span><span class="p">,</span>
    <span class="n">zarr_region_dims</span><span class="p">,</span>
    <span class="n">root_attrs_json_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">new_attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Init a Zarr Store for writing QDM output regionally in independent processes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    simulation : str</span>
<span class="sd">        fsspec-compatible URL containing simulation data to be adjusted.</span>
<span class="sd">    variable : str</span>
<span class="sd">        Target variable in `simulation` to adjust. Adjusted output will share the</span>
<span class="sd">        same name.</span>
<span class="sd">    years : sequence of ints</span>
<span class="sd">        Years of simulation to adjust, with rolling years and day grouping.</span>
<span class="sd">    out : str</span>
<span class="sd">        fsspec-compatible path or URL pointing to Zarr Store file where the</span>
<span class="sd">        QDM-adjusted simulation data will be written.</span>
<span class="sd">    zarr_region_dims: sequence of str</span>
<span class="sd">        Sequence giving the name of dimensions that will be used to later write</span>
<span class="sd">        to regions of the Zarr Store. Variables with dimensions that do not use</span>
<span class="sd">        these regional variables will be appended to the primed Zarr Store as</span>
<span class="sd">        part of this call.</span>
<span class="sd">    root_attrs_json_file : str or None, optional</span>
<span class="sd">        fsspec-compatible URL pointing to a JSON file to use as root ``attrs``</span>
<span class="sd">        for the output data. ``new_attrs`` will be appended to this.</span>
<span class="sd">    new_attrs : dict or None, optional</span>
<span class="sd">        dict to merge with output Dataset&#39;s root ``attrs`` before output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: Options to change primed output zarr store chunking?</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>  <span class="c1"># TODO: Clean up this import or move the import-depending code to doodla.core</span>

    <span class="n">quantile_variable_name</span> <span class="o">=</span> <span class="s2">&quot;sim_q&quot;</span>
    <span class="n">sim_df</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">root_attrs_json_file</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using root attrs from </span><span class="si">{</span><span class="n">root_attrs_json_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sim_df</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read_attrs</span><span class="p">(</span><span class="n">root_attrs_json_file</span><span class="p">)</span>

    <span class="c1"># Yes, the time slice needs to use strs, not ints. It&#39;s already going to be inclusive so don&#39;t need to +1.</span>
    <span class="n">primer</span> <span class="o">=</span> <span class="n">sim_df</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">years</span><span class="p">)),</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">years</span><span class="p">))))</span>

    <span class="c1">## This is where chunking happens... not sure about whether this is needed or how to effectively handle this.</span>
    <span class="c1"># primed_out = dodola.repository.read(simulation_zarr).sel(time=timeslice).chunk({&quot;time&quot;: 73, &quot;lat&quot;: 10, &quot;lon&quot;:180})</span>

    <span class="n">primer</span><span class="p">[</span><span class="n">quantile_variable_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">primer</span><span class="p">[</span><span class="n">variable</span><span class="p">])</span>
    <span class="c1"># Analysts said sim_q needed no attrs.</span>
    <span class="n">primer</span><span class="p">[</span><span class="n">quantile_variable_name</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">new_attrs</span><span class="p">:</span>
        <span class="n">primer</span><span class="o">.</span><span class="n">attrs</span> <span class="o">|=</span> <span class="n">new_attrs</span>

    <span class="c1"># Logic below might be better off in dodola.repository.</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Priming Zarr Store with </span><span class="si">{</span><span class="n">primer</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">primer</span><span class="o">.</span><span class="n">to_zarr</span><span class="p">(</span>
        <span class="n">out</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span>
        <span class="n">compute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">consolidated</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">safe_chunks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Written primer to </span><span class="si">{</span><span class="n">out</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Append variables that do not depend on dims we&#39;re using to define the</span>
    <span class="c1"># region we&#39;ll later write to in the Zarr Store.</span>
    <span class="n">variables_to_append</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">variable_name</span><span class="p">,</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">primer</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
            <span class="n">region_variable</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">variable</span><span class="o">.</span><span class="n">dims</span> <span class="k">for</span> <span class="n">region_variable</span> <span class="ow">in</span> <span class="n">zarr_region_dims</span>
        <span class="p">):</span>
            <span class="n">variables_to_append</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variable_name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">variables_to_append</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Appending </span><span class="si">{</span><span class="n">variables_to_append</span><span class="si">}</span><span class="s2"> to primed Zarr Store&quot;</span><span class="p">)</span>
        <span class="n">primer</span><span class="p">[</span><span class="n">variables_to_append</span><span class="p">]</span><span class="o">.</span><span class="n">to_zarr</span><span class="p">(</span>
            <span class="n">out</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">consolidated</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">safe_chunks</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Appended non-regional variables to </span><span class="si">{</span><span class="n">out</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No non-regional variables to append to Zarr Store&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.services.prime_qplad_output_zarrstore" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.services.prime_qplad_output_zarrstore</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">prime_qplad_output_zarrstore</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">zarr_region_dims</span><span class="p">,</span> <span class="n">root_attrs_json_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">new_attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Init a Zarr Store for writing QPLAD output regionally in independent processes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>simulation</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fsspec-compatible URL containing simulation data to be adjusted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>variable</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target variable in <code>simulation</code> to adjust. Adjusted output will share the
same name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fsspec-compatible path or URL pointing to Zarr Store file where the
QPLAD-adjusted simulation data will be written.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>zarr_region_dims</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sequence giving the name of dimensions that will be used to later write
to regions of the Zarr Store. Variables with dimensions that do not use
these regional variables will be appended to the primed Zarr Store as
part of this call.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>root_attrs_json_file</code>
            </td>
            <td>
                  <code><span title="str">str</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fsspec-compatible URL pointing to a JSON file to use as root <code>attrs</code>
for the output data. <code>new_attrs</code> will be appended to this.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_attrs</code>
            </td>
            <td>
                  <code><span title="dict">dict</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict to merge with output Dataset's root <code>attrs</code> before output.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>dodola/services.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@log_service</span>
<span class="k">def</span><span class="w"> </span><span class="nf">prime_qplad_output_zarrstore</span><span class="p">(</span>
    <span class="n">simulation</span><span class="p">,</span>
    <span class="n">variable</span><span class="p">,</span>
    <span class="n">out</span><span class="p">,</span>
    <span class="n">zarr_region_dims</span><span class="p">,</span>
    <span class="n">root_attrs_json_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">new_attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Init a Zarr Store for writing QPLAD output regionally in independent processes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    simulation : str</span>
<span class="sd">        fsspec-compatible URL containing simulation data to be adjusted.</span>
<span class="sd">    variable : str</span>
<span class="sd">        Target variable in `simulation` to adjust. Adjusted output will share the</span>
<span class="sd">        same name.</span>
<span class="sd">    out : str</span>
<span class="sd">        fsspec-compatible path or URL pointing to Zarr Store file where the</span>
<span class="sd">        QPLAD-adjusted simulation data will be written.</span>
<span class="sd">    zarr_region_dims: sequence of str</span>
<span class="sd">        Sequence giving the name of dimensions that will be used to later write</span>
<span class="sd">        to regions of the Zarr Store. Variables with dimensions that do not use</span>
<span class="sd">        these regional variables will be appended to the primed Zarr Store as</span>
<span class="sd">        part of this call.</span>
<span class="sd">    root_attrs_json_file : str or None, optional</span>
<span class="sd">        fsspec-compatible URL pointing to a JSON file to use as root ``attrs``</span>
<span class="sd">        for the output data. ``new_attrs`` will be appended to this.</span>
<span class="sd">    new_attrs : dict or None, optional</span>
<span class="sd">        dict to merge with output Dataset&#39;s root ``attrs`` before output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sim_df</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">root_attrs_json_file</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using root attrs from </span><span class="si">{</span><span class="n">root_attrs_json_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sim_df</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read_attrs</span><span class="p">(</span><span class="n">root_attrs_json_file</span><span class="p">)</span>

    <span class="n">primer</span> <span class="o">=</span> <span class="n">sim_df</span><span class="p">[[</span><span class="n">variable</span><span class="p">]]</span>
    <span class="c1"># Ensure we get root attrs. Not sure explicit copy is still required.</span>
    <span class="n">primer</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">sim_df</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">new_attrs</span><span class="p">:</span>
        <span class="n">primer</span><span class="o">.</span><span class="n">attrs</span> <span class="o">|=</span> <span class="n">new_attrs</span>

    <span class="c1"># Logic below might be better off in dodola.repository.</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Priming Zarr Store with </span><span class="si">{</span><span class="n">primer</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">primer</span><span class="o">.</span><span class="n">to_zarr</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">consolidated</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Written primer to </span><span class="si">{</span><span class="n">out</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Append variables that do not depend on dims we&#39;re using to define the</span>
    <span class="c1"># region we&#39;ll later write to in the Zarr Store.</span>
    <span class="n">variables_to_append</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">variable_name</span><span class="p">,</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">primer</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
            <span class="n">region_variable</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">variable</span><span class="o">.</span><span class="n">dims</span> <span class="k">for</span> <span class="n">region_variable</span> <span class="ow">in</span> <span class="n">zarr_region_dims</span>
        <span class="p">):</span>
            <span class="n">variables_to_append</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variable_name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">variables_to_append</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Appending </span><span class="si">{</span><span class="n">variables_to_append</span><span class="si">}</span><span class="s2"> to primed Zarr Store&quot;</span><span class="p">)</span>
        <span class="n">primer</span><span class="p">[</span><span class="n">variables_to_append</span><span class="p">]</span><span class="o">.</span><span class="n">to_zarr</span><span class="p">(</span>
            <span class="n">out</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">consolidated</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">safe_chunks</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Appended non-regional variables to </span><span class="si">{</span><span class="n">out</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No non-regional variables to append to Zarr Store&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.services.rechunk" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.services.rechunk</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">rechunk</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">target_chunks</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Rechunk data to specification</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Storage URL to input data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_chunks</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mapping {coordinate_name: chunk_size} showing how data is
to be rechunked.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Storage URL to write rechunked output to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>dodola/services.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@log_service</span>
<span class="k">def</span><span class="w"> </span><span class="nf">rechunk</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">target_chunks</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Rechunk data to specification</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : str</span>
<span class="sd">        Storage URL to input data.</span>
<span class="sd">    target_chunks : dict</span>
<span class="sd">        Mapping {coordinate_name: chunk_size} showing how data is</span>
<span class="sd">        to be rechunked.</span>
<span class="sd">    out : str</span>
<span class="sd">        Storage URL to write rechunked output to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># Simple, stable, but not for more specialized rechunking needs.</span>
    <span class="c1"># In that case use &quot;rechunker&quot; package, or similar.</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">target_chunks</span><span class="p">)</span>

    <span class="c1"># Hack to get around issue with writing chunks to zarr in xarray ~v0.17.0</span>
    <span class="c1"># https://github.com/pydata/xarray/issues/2300</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">del</span> <span class="n">ds</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">encoding</span><span class="p">[</span><span class="s2">&quot;chunks&quot;</span><span class="p">]</span>

    <span class="n">storage</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">ds</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.services.regrid" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.services.regrid</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">regrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">domain_file</span><span class="p">,</span> <span class="n">weights_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">astype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_cyclic</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Regrid climate data</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Storage URL to input xr.Dataset that will be regridded.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Storage URL to write regridded output to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Method of regridding. Passed to <code>xesmf.Regridder</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>domain_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Storage URL to input xr.Dataset domain file to regrid to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>weights_path</code>
            </td>
            <td>
                  <code><span title="optional">optional</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Local file path name to write regridding weights file to.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>astype</code>
            </td>
            <td>
                  <code>str, numpy.dtype, or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Typecode or data-type to which the regridded output is cast.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>add_cyclic</code>
            </td>
            <td>
                  <code>str, or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Add cyclic (aka wrap-around values) to dimension before regridding.
 Useful for avoiding dateline artifacts along longitude in global
 datasets.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>dodola/services.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@log_service</span>
<span class="k">def</span><span class="w"> </span><span class="nf">regrid</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">domain_file</span><span class="p">,</span> <span class="n">weights_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">astype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_cyclic</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Regrid climate data</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : str</span>
<span class="sd">        Storage URL to input xr.Dataset that will be regridded.</span>
<span class="sd">    out : str</span>
<span class="sd">        Storage URL to write regridded output to.</span>
<span class="sd">    method : str</span>
<span class="sd">        Method of regridding. Passed to ``xesmf.Regridder``.</span>
<span class="sd">    domain_file : str</span>
<span class="sd">        Storage URL to input xr.Dataset domain file to regrid to.</span>
<span class="sd">    weights_path : optional</span>
<span class="sd">        Local file path name to write regridding weights file to.</span>
<span class="sd">    astype : str, numpy.dtype, or None, optional</span>
<span class="sd">        Typecode or data-type to which the regridded output is cast.</span>
<span class="sd">    add_cyclic : str, or None, optional</span>
<span class="sd">        Add cyclic (aka wrap-around values) to dimension before regridding.</span>
<span class="sd">         Useful for avoiding dateline artifacts along longitude in global</span>
<span class="sd">         datasets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ds_domain</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">domain_file</span><span class="p">)</span>

    <span class="n">regridded_ds</span> <span class="o">=</span> <span class="n">xesmf_regrid</span><span class="p">(</span>
        <span class="n">ds</span><span class="p">,</span>
        <span class="n">ds_domain</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
        <span class="n">weights_path</span><span class="o">=</span><span class="n">weights_path</span><span class="p">,</span>
        <span class="n">astype</span><span class="o">=</span><span class="n">astype</span><span class="p">,</span>
        <span class="n">add_cyclic</span><span class="o">=</span><span class="n">add_cyclic</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">storage</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">regridded_ds</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.services.remove_leapdays" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.services.remove_leapdays</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">remove_leapdays</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Removes leap days and updates calendar attribute</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Storage URL to input xr.Dataset that will be regridded.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Storage URL to write regridded output to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>dodola/services.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@log_service</span>
<span class="k">def</span><span class="w"> </span><span class="nf">remove_leapdays</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Removes leap days and updates calendar attribute</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : str</span>
<span class="sd">        Storage URL to input xr.Dataset that will be regridded.</span>
<span class="sd">    out : str</span>
<span class="sd">        Storage URL to write regridded output to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">noleap_ds</span> <span class="o">=</span> <span class="n">xclim_remove_leapdays</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
    <span class="n">storage</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">noleap_ds</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.services.train_qdm" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.services.train_qdm</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">train_qdm</span><span class="p">(</span><span class="n">historical</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">sel_slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">isel_slice</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Train quantile delta mapping and dump to <code>out</code></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>historical</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fsspec-compatible URL to historical simulation store.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reference</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fsspec-compatible URL to store to use as model reference.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fsspec-compatible URL to store trained model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>variable</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of target variable in input and output stores.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kind</code>
            </td>
            <td>
                  <code>(<span title="additive">additive</span>, <span title="multiplicative">multiplicative</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Kind of QDM scaling.</p>
              </div>
            </td>
            <td>
                  <code>&#34;additive&#34;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sel_slice</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Label-index slice hist and ref to subset before training.
A mapping of {variable_name: slice(...)} passed to
<code>xarray.Dataset.sel()</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>isel_slice</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Integer-index slice hist and ref to subset before training. A mapping
of {variable_name: slice(...)} passed to <code>xarray.Dataset.isel()</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>dodola/services.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@log_service</span>
<span class="k">def</span><span class="w"> </span><span class="nf">train_qdm</span><span class="p">(</span>
    <span class="n">historical</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">sel_slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">isel_slice</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Train quantile delta mapping and dump to `out`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    historical : str</span>
<span class="sd">        fsspec-compatible URL to historical simulation store.</span>
<span class="sd">    reference : str</span>
<span class="sd">        fsspec-compatible URL to store to use as model reference.</span>
<span class="sd">    out : str</span>
<span class="sd">        fsspec-compatible URL to store trained model.</span>
<span class="sd">    variable : str</span>
<span class="sd">        Name of target variable in input and output stores.</span>
<span class="sd">    kind : {&quot;additive&quot;, &quot;multiplicative&quot;}</span>
<span class="sd">        Kind of QDM scaling.</span>
<span class="sd">    sel_slice: dict or None, optional</span>
<span class="sd">        Label-index slice hist and ref to subset before training.</span>
<span class="sd">        A mapping of {variable_name: slice(...)} passed to</span>
<span class="sd">        `xarray.Dataset.sel()`.</span>
<span class="sd">    isel_slice: dict or None, optional</span>
<span class="sd">        Integer-index slice hist and ref to subset before training. A mapping</span>
<span class="sd">        of {variable_name: slice(...)} passed to `xarray.Dataset.isel()`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">historical</span><span class="p">)</span>
    <span class="n">ref</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span>

    <span class="n">kind_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;additive&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;multiplicative&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">kind_map</span><span class="p">[</span><span class="n">kind</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="c1"># So we get a helpful exception message showing accepted kwargs...</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;kind must be </span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">kind_map</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">, got </span><span class="si">{</span><span class="n">kind</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sel_slice</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Slicing by </span><span class="si">{</span><span class="n">sel_slice</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">hist</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">sel_slice</span><span class="p">)</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">sel_slice</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">isel_slice</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Slicing by </span><span class="si">{</span><span class="n">isel_slice</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">hist</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">isel_slice</span><span class="p">)</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">isel_slice</span><span class="p">)</span>

    <span class="n">ref</span> <span class="o">=</span> <span class="n">xclim_units_any2pint</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">xclim_units_any2pint</span><span class="p">(</span><span class="n">hist</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>

    <span class="n">qdm</span> <span class="o">=</span> <span class="n">train_quantiledeltamapping</span><span class="p">(</span>
        <span class="n">reference</span><span class="o">=</span><span class="n">ref</span><span class="p">,</span> <span class="n">historical</span><span class="o">=</span><span class="n">hist</span><span class="p">,</span> <span class="n">variable</span><span class="o">=</span><span class="n">variable</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">k</span>
    <span class="p">)</span>

    <span class="n">storage</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">qdm</span><span class="o">.</span><span class="n">ds</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.services.train_qplad" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.services.train_qplad</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">train_qplad</span><span class="p">(</span><span class="n">coarse_reference</span><span class="p">,</span> <span class="n">fine_reference</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">sel_slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">isel_slice</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Train Quantile-Preserving, Localized Analogs Downscaling and dump to <code>out</code></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>coarse_reference</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fsspec-compatible URL to resampled coarse reference store.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fine_reference</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fsspec-compatible URL to fine-resolution reference store.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>fsspec-compatible URL to store adjustment factors.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>variable</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of target variable in input and output stores.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kind</code>
            </td>
            <td>
                  <code>(<span title="additive">additive</span>, <span title="multiplicative">multiplicative</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Kind of QPLAD downscaling.</p>
              </div>
            </td>
            <td>
                  <code>&#34;additive&#34;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sel_slice</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Label-index slice hist and ref to subset before training.
A mapping of {variable_name: slice(...)} passed to
<code>xarray.Dataset.sel()</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>isel_slice</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Integer-index slice hist and ref to subset before training. A mapping
of {variable_name: slice(...)} passed to <code>xarray.Dataset.isel()</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>dodola/services.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@log_service</span>
<span class="k">def</span><span class="w"> </span><span class="nf">train_qplad</span><span class="p">(</span>
    <span class="n">coarse_reference</span><span class="p">,</span>
    <span class="n">fine_reference</span><span class="p">,</span>
    <span class="n">out</span><span class="p">,</span>
    <span class="n">variable</span><span class="p">,</span>
    <span class="n">kind</span><span class="p">,</span>
    <span class="n">sel_slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">isel_slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Train Quantile-Preserving, Localized Analogs Downscaling and dump to `out`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    coarse_reference : str</span>
<span class="sd">        fsspec-compatible URL to resampled coarse reference store.</span>
<span class="sd">    fine_reference : str</span>
<span class="sd">        fsspec-compatible URL to fine-resolution reference store.</span>
<span class="sd">    out : str</span>
<span class="sd">        fsspec-compatible URL to store adjustment factors.</span>
<span class="sd">    variable : str</span>
<span class="sd">        Name of target variable in input and output stores.</span>
<span class="sd">    kind : {&quot;additive&quot;, &quot;multiplicative&quot;}</span>
<span class="sd">        Kind of QPLAD downscaling.</span>
<span class="sd">    sel_slice: dict or None, optional</span>
<span class="sd">        Label-index slice hist and ref to subset before training.</span>
<span class="sd">        A mapping of {variable_name: slice(...)} passed to</span>
<span class="sd">        `xarray.Dataset.sel()`.</span>
<span class="sd">    isel_slice: dict or None, optional</span>
<span class="sd">        Integer-index slice hist and ref to subset before training. A mapping</span>
<span class="sd">        of {variable_name: slice(...)} passed to `xarray.Dataset.isel()`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ref_coarse</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">coarse_reference</span><span class="p">)</span>
    <span class="n">ref_fine</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fine_reference</span><span class="p">)</span>

    <span class="n">kind_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;additive&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;multiplicative&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">kind_map</span><span class="p">[</span><span class="n">kind</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="c1"># So we get a helpful exception message showing accepted kwargs...</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;kind must be </span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">kind_map</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">, got </span><span class="si">{</span><span class="n">kind</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sel_slice</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Slicing by </span><span class="si">{</span><span class="n">sel_slice</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ref_coarse</span> <span class="o">=</span> <span class="n">ref_coarse</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">sel_slice</span><span class="p">)</span>
        <span class="n">ref_fine</span> <span class="o">=</span> <span class="n">ref_fine</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">sel_slice</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">isel_slice</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Slicing by </span><span class="si">{</span><span class="n">isel_slice</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ref_coarse</span> <span class="o">=</span> <span class="n">ref_coarse</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">isel_slice</span><span class="p">)</span>
        <span class="n">ref_fine</span> <span class="o">=</span> <span class="n">ref_fine</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">isel_slice</span><span class="p">)</span>

    <span class="c1"># needs to not be chunked</span>
    <span class="n">ref_coarse</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
    <span class="n">ref_fine</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

    <span class="n">ref_coarse</span> <span class="o">=</span> <span class="n">xclim_units_any2pint</span><span class="p">(</span><span class="n">ref_coarse</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>
    <span class="n">ref_fine</span> <span class="o">=</span> <span class="n">xclim_units_any2pint</span><span class="p">(</span><span class="n">ref_fine</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>

    <span class="n">qplad</span> <span class="o">=</span> <span class="n">train_analogdownscaling</span><span class="p">(</span>
        <span class="n">coarse_reference</span><span class="o">=</span><span class="n">ref_coarse</span><span class="p">,</span>
        <span class="n">fine_reference</span><span class="o">=</span><span class="n">ref_fine</span><span class="p">,</span>
        <span class="n">variable</span><span class="o">=</span><span class="n">variable</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="n">k</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">storage</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">qplad</span><span class="o">.</span><span class="n">ds</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.services.validate" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.services.validate</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">time_period</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Performs validation on an input dataset</p>
<p>Valid for CMIP6, bias corrected and downscaled. Raises AssertionError when
validation fails.</p>
<p>This function performs more memory-intensive tests by reading input data
and subsetting to each year in the "time" dimension.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Storage URL to input xr.Dataset that will be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>var</code>
            </td>
            <td>
                  <code>(<span title="tasmax">tasmax</span>, <span title="tasmin">tasmin</span>, <span title="dtr">dtr</span>, <span title="pr">pr</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Variable in xr.Dataset that should be validated.
Some validation functions are specific to each variable.</p>
              </div>
            </td>
            <td>
                  <code>&#34;tasmax&#34;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_type</code>
            </td>
            <td>
                  <code>(<span title="cmip6">cmip6</span>, <span title="bias_corrected">bias_corrected</span>, <span title="downscaled">downscaled</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Step in pipeline, used in determining how to validate.</p>
              </div>
            </td>
            <td>
                  <code>&#34;cmip6&#34;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time_period</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time period that input data should cover, used in validating the number of timesteps
in conjunction with the data type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>dodola/services.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@log_service</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">time_period</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs validation on an input dataset</span>

<span class="sd">    Valid for CMIP6, bias corrected and downscaled. Raises AssertionError when</span>
<span class="sd">    validation fails.</span>

<span class="sd">    This function performs more memory-intensive tests by reading input data</span>
<span class="sd">    and subsetting to each year in the &quot;time&quot; dimension.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : str</span>
<span class="sd">        Storage URL to input xr.Dataset that will be validated.</span>
<span class="sd">    var : {&quot;tasmax&quot;, &quot;tasmin&quot;, &quot;dtr&quot;, &quot;pr&quot;}</span>
<span class="sd">        Variable in xr.Dataset that should be validated.</span>
<span class="sd">        Some validation functions are specific to each variable.</span>
<span class="sd">    data_type : {&quot;cmip6&quot;, &quot;bias_corrected&quot;, &quot;downscaled&quot;}</span>
<span class="sd">        Step in pipeline, used in determining how to validate.</span>
<span class="sd">    time_period: {&quot;historical&quot;, &quot;future&quot;}</span>
<span class="sd">        Time period that input data should cover, used in validating the number of timesteps</span>
<span class="sd">        in conjunction with the data type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># This is pretty rough but works to communicate the idea.</span>
    <span class="c1"># Consider having failed tests raise something like ValidationError rather</span>
    <span class="c1"># than AssertionErrors.</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># These only read in Zarr Store metadata -- not memory intensive.</span>
    <span class="n">test_variable_names</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
    <span class="n">test_timesteps</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">time_period</span><span class="p">)</span>

    <span class="c1"># Other test are done on annual selections with dask.delayed to</span>
    <span class="c1"># avoid large memory errors.</span>
    <span class="c1"># Doing all this here because this involves storage and I/O logic.</span>
    <span class="nd">@dask</span><span class="o">.</span><span class="n">delayed</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">memory_intensive_tests</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

        <span class="n">test_for_nans</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s2">&quot;tasmin&quot;</span><span class="p">:</span>
            <span class="n">test_temp_range</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">v</span> <span class="o">==</span> <span class="s2">&quot;tasmax&quot;</span><span class="p">:</span>
            <span class="n">test_temp_range</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">v</span> <span class="o">==</span> <span class="s2">&quot;dtr&quot;</span><span class="p">:</span>
            <span class="n">test_dtr_range</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">data_type</span><span class="p">)</span>
            <span class="n">test_negative_values</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">v</span> <span class="o">==</span> <span class="s2">&quot;pr&quot;</span><span class="p">:</span>
            <span class="n">test_negative_values</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="n">test_maximum_precip</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Argument </span><span class="si">{</span><span class="n">v</span><span class="si">=}</span><span class="s2"> not recognized&quot;</span><span class="p">)</span>

        <span class="c1"># Assumes error thrown if had problem before this.</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Validating year </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">memory_intensive_tests</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>  <span class="c1"># Likely don&#39;t need this</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": [], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>