
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../cli/">
      
      
        <link rel="next" href="../repository/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>dodola.core - dodola Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dodola.core.adjust_analogdownscaling" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="dodola Documentation" class="md-header__button md-logo" aria-label="dodola Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            dodola Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              dodola.core
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/climateimpactlab/dodola" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="dodola Documentation" class="md-nav__button md-logo" aria-label="dodola Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    dodola Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/climateimpactlab/dodola" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    dodola.cli
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    dodola.core
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    dodola.core
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dodola.core.adjust_analogdownscaling" class="md-nav__link">
    <span class="md-ellipsis">
      adjust_analogdownscaling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.adjust_quantiledeltamapping" class="md-nav__link">
    <span class="md-ellipsis">
      adjust_quantiledeltamapping
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.adjust_quantiledeltamapping_year" class="md-nav__link">
    <span class="md-ellipsis">
      adjust_quantiledeltamapping_year
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.apply_precip_ceiling" class="md-nav__link">
    <span class="md-ellipsis">
      apply_precip_ceiling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.apply_wet_day_frequency_correction" class="md-nav__link">
    <span class="md-ellipsis">
      apply_wet_day_frequency_correction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.dtr_floor" class="md-nav__link">
    <span class="md-ellipsis">
      dtr_floor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.non_polar_dtr_ceiling" class="md-nav__link">
    <span class="md-ellipsis">
      non_polar_dtr_ceiling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.standardize_gcm" class="md-nav__link">
    <span class="md-ellipsis">
      standardize_gcm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.test_dtr_range" class="md-nav__link">
    <span class="md-ellipsis">
      test_dtr_range
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.test_for_nans" class="md-nav__link">
    <span class="md-ellipsis">
      test_for_nans
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.test_maximum_precip" class="md-nav__link">
    <span class="md-ellipsis">
      test_maximum_precip
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.test_negative_values" class="md-nav__link">
    <span class="md-ellipsis">
      test_negative_values
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.test_temp_range" class="md-nav__link">
    <span class="md-ellipsis">
      test_temp_range
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.test_timesteps" class="md-nav__link">
    <span class="md-ellipsis">
      test_timesteps
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.test_variable_names" class="md-nav__link">
    <span class="md-ellipsis">
      test_variable_names
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.train_analogdownscaling" class="md-nav__link">
    <span class="md-ellipsis">
      train_analogdownscaling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.train_quantiledeltamapping" class="md-nav__link">
    <span class="md-ellipsis">
      train_quantiledeltamapping
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.xclim_convert_360day_calendar_interpolate" class="md-nav__link">
    <span class="md-ellipsis">
      xclim_convert_360day_calendar_interpolate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.xclim_remove_leapdays" class="md-nav__link">
    <span class="md-ellipsis">
      xclim_remove_leapdays
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.xclim_units_any2pint" class="md-nav__link">
    <span class="md-ellipsis">
      xclim_units_any2pint
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.xclim_units_pint2cf" class="md-nav__link">
    <span class="md-ellipsis">
      xclim_units_pint2cf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.xesmf_regrid" class="md-nav__link">
    <span class="md-ellipsis">
      xesmf_regrid
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../repository/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    dodola.repository
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    dodola.services
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dodola.core.adjust_analogdownscaling" class="md-nav__link">
    <span class="md-ellipsis">
      adjust_analogdownscaling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.adjust_quantiledeltamapping" class="md-nav__link">
    <span class="md-ellipsis">
      adjust_quantiledeltamapping
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.adjust_quantiledeltamapping_year" class="md-nav__link">
    <span class="md-ellipsis">
      adjust_quantiledeltamapping_year
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.apply_precip_ceiling" class="md-nav__link">
    <span class="md-ellipsis">
      apply_precip_ceiling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.apply_wet_day_frequency_correction" class="md-nav__link">
    <span class="md-ellipsis">
      apply_wet_day_frequency_correction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.dtr_floor" class="md-nav__link">
    <span class="md-ellipsis">
      dtr_floor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.non_polar_dtr_ceiling" class="md-nav__link">
    <span class="md-ellipsis">
      non_polar_dtr_ceiling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.standardize_gcm" class="md-nav__link">
    <span class="md-ellipsis">
      standardize_gcm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.test_dtr_range" class="md-nav__link">
    <span class="md-ellipsis">
      test_dtr_range
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.test_for_nans" class="md-nav__link">
    <span class="md-ellipsis">
      test_for_nans
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.test_maximum_precip" class="md-nav__link">
    <span class="md-ellipsis">
      test_maximum_precip
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.test_negative_values" class="md-nav__link">
    <span class="md-ellipsis">
      test_negative_values
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.test_temp_range" class="md-nav__link">
    <span class="md-ellipsis">
      test_temp_range
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.test_timesteps" class="md-nav__link">
    <span class="md-ellipsis">
      test_timesteps
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.test_variable_names" class="md-nav__link">
    <span class="md-ellipsis">
      test_variable_names
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.train_analogdownscaling" class="md-nav__link">
    <span class="md-ellipsis">
      train_analogdownscaling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.train_quantiledeltamapping" class="md-nav__link">
    <span class="md-ellipsis">
      train_quantiledeltamapping
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.xclim_convert_360day_calendar_interpolate" class="md-nav__link">
    <span class="md-ellipsis">
      xclim_convert_360day_calendar_interpolate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.xclim_remove_leapdays" class="md-nav__link">
    <span class="md-ellipsis">
      xclim_remove_leapdays
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.xclim_units_any2pint" class="md-nav__link">
    <span class="md-ellipsis">
      xclim_units_any2pint
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.xclim_units_pint2cf" class="md-nav__link">
    <span class="md-ellipsis">
      xclim_units_pint2cf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dodola.core.xesmf_regrid" class="md-nav__link">
    <span class="md-ellipsis">
      xesmf_regrid
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>dodola.core</h1>

<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">

        <p>Core logic for bias adjustment and downscaling</p>
<p>Math stuff and business logic goes here. This is the "business logic".</p>












<p><span class="doc-section-title">Functions:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.core.adjust_analogdownscaling" href="#dodola.core.adjust_analogdownscaling">adjust_analogdownscaling</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Apply QPLAD to downscale bias corrected output.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.core.adjust_quantiledeltamapping" href="#dodola.core.adjust_quantiledeltamapping">adjust_quantiledeltamapping</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Apply QDM to adjust a range of years within a simulation.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.core.adjust_quantiledeltamapping_year" href="#dodola.core.adjust_quantiledeltamapping_year">adjust_quantiledeltamapping_year</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Apply QDM to adjust a year within a simulation.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.core.apply_precip_ceiling" href="#dodola.core.apply_precip_ceiling">apply_precip_ceiling</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Converts all precip values above a threshold to the threshold value, uniformly across space and time.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.core.apply_wet_day_frequency_correction" href="#dodola.core.apply_wet_day_frequency_correction">apply_wet_day_frequency_correction</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Parameters</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.core.dtr_floor" href="#dodola.core.dtr_floor">dtr_floor</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Converts all diurnal temperature range (DTR) values strictly below a floor</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.core.non_polar_dtr_ceiling" href="#dodola.core.non_polar_dtr_ceiling">non_polar_dtr_ceiling</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Converts all non-polar (regions between the 60th south and north parallel) diurnal temperature range (DTR) values strictly above a ceiling</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.core.standardize_gcm" href="#dodola.core.standardize_gcm">standardize_gcm</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>360 calendar conversion requires that there are no chunks in</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.core.test_dtr_range" href="#dodola.core.test_dtr_range">test_dtr_range</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Ensure DTR values are in a valid range</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.core.test_for_nans" href="#dodola.core.test_for_nans">test_for_nans</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Tests for presence of NaNs</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.core.test_maximum_precip" href="#dodola.core.test_maximum_precip">test_maximum_precip</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Tests that max precip is reasonable</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.core.test_negative_values" href="#dodola.core.test_negative_values">test_negative_values</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Tests for presence of negative values</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.core.test_temp_range" href="#dodola.core.test_temp_range">test_temp_range</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Ensure temperature values are in a valid range</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.core.test_timesteps" href="#dodola.core.test_timesteps">test_timesteps</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Tests that Dataset contains the correct number of timesteps (number of days on a noleap calendar)</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.core.test_variable_names" href="#dodola.core.test_variable_names">test_variable_names</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Test that the correct variable name exists in the file</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.core.train_analogdownscaling" href="#dodola.core.train_analogdownscaling">train_analogdownscaling</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Train Quantile-Preserving, Localized Analogs Downscaling (QPLAD)</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.core.train_quantiledeltamapping" href="#dodola.core.train_quantiledeltamapping">train_quantiledeltamapping</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Train quantile delta mapping</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.core.xclim_convert_360day_calendar_interpolate" href="#dodola.core.xclim_convert_360day_calendar_interpolate">xclim_convert_360day_calendar_interpolate</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Parameters</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.core.xclim_remove_leapdays" href="#dodola.core.xclim_remove_leapdays">xclim_remove_leapdays</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Parameters</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.core.xclim_units_any2pint" href="#dodola.core.xclim_units_any2pint">xclim_units_any2pint</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Parameters</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.core.xclim_units_pint2cf" href="#dodola.core.xclim_units_pint2cf">xclim_units_pint2cf</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Parameters</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dodola.core.xesmf_regrid" href="#dodola.core.xesmf_regrid">xesmf_regrid</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Regrid a Dataset.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>





  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="dodola.core.adjust_analogdownscaling" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.core.adjust_analogdownscaling</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">adjust_analogdownscaling</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">qplad</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Apply QPLAD to downscale bias corrected output.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>simulation</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Daily bias corrected data to be downscaled. Target variable must have a units attribute.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>qplad</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span> or <span title="xclim.sdba.adjustment.QuantilePreservingAnalogDownscaling">QuantilePreservingAnalogDownscaling</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Trained <code>xclim.sdba.adjustment.QuantilePreservingAnalogDownscaling</code>, or
Dataset representation that will instantiate
<code>xclim.sdba.adjustment.QuantilePreservingAnalogDownscaling</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>variable</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target variable in <code>simulation</code> to downscale. Downscaled output will share the
same name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>QPLAD-downscaled values from <code>simulation</code>. May be a lazy-evaluated future, not
yet computed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>dodola/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">adjust_analogdownscaling</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">qplad</span><span class="p">,</span> <span class="n">variable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply QPLAD to downscale bias corrected output.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    simulation : xr.Dataset</span>
<span class="sd">        Daily bias corrected data to be downscaled. Target variable must have a units attribute.</span>
<span class="sd">    qplad : xr.Dataset or sdba.adjustment.QuantilePreservingAnalogDownscaling</span>
<span class="sd">        Trained ``xclim.sdba.adjustment.QuantilePreservingAnalogDownscaling``, or</span>
<span class="sd">        Dataset representation that will instantiate</span>
<span class="sd">        ``xclim.sdba.adjustment.QuantilePreservingAnalogDownscaling``.</span>
<span class="sd">    variable : str</span>
<span class="sd">        Target variable in `simulation` to downscale. Downscaled output will share the</span>
<span class="sd">        same name.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : xr.Dataset</span>
<span class="sd">        QPLAD-downscaled values from `simulation`. May be a lazy-evaluated future, not</span>
<span class="sd">        yet computed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">variable</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">qplad</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
        <span class="n">qplad</span> <span class="o">=</span> <span class="n">sdba</span><span class="o">.</span><span class="n">adjustment</span><span class="o">.</span><span class="n">QuantilePreservingAnalogDownscaling</span><span class="o">.</span><span class="n">from_dataset</span><span class="p">(</span><span class="n">qplad</span><span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="n">qplad</span><span class="o">.</span><span class="n">adjust</span><span class="p">(</span><span class="n">simulation</span><span class="p">[</span><span class="n">variable</span><span class="p">])</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">variable</span><span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="o">*</span><span class="n">simulation</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span>
    <span class="c1"># Overwrite QPLAD output attrs with input simulation attrs.</span>
    <span class="n">out</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">attrs</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">simulation</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">attrs</span>

    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.core.adjust_quantiledeltamapping" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.core.adjust_quantiledeltamapping</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">adjust_quantiledeltamapping</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">qdm</span><span class="p">,</span> <span class="n">years</span><span class="p">,</span> <span class="n">astype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quantile_variable</span><span class="o">=</span><span class="s1">&#39;sim_q&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Apply QDM to adjust a range of years within a simulation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>simulation</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Daily simulation data to be adjusted. Must have sufficient observations
around <code>year</code> to adjust. Target variable must have a units attribute.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>variable</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target variable in <code>simulation</code> to adjust. Adjusted output will
share the same name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>qdm</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span> or <span title="xclim.sdba.adjustment.QuantileDeltaMapping">QuantileDeltaMapping</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Trained <code>xclim.sdba.adjustment.QuantileDeltaMapping</code>, or Dataset
representation that will be instantiate
<code>xclim.sdba.adjustment.QuantileDeltaMapping</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>years</code>
            </td>
            <td>
                  <code>sequence of ints</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Years of simulation to adjust, with rolling years and day grouping.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>astype</code>
            </td>
            <td>
                  <code>str, numpy.dtype, or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Typecode or data-type to which the regridded output is cast.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>quantile_variable</code>
            </td>
            <td>
                  <code><span title="str">str</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of quantile coordinate to reset to data variable. Not reset
if <code>None</code>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;sim_q&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments passed to
<code>dodola.core.adjust_quantiledeltamapping_year</code>.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>QDM-adjusted values from <code>simulation</code>. May be a lazy-evaluated future, not
yet computed. In addition to adjusted original variables, this includes
"sim_q" variable giving quantiles from QDM biasadjustment.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>dodola/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">adjust_quantiledeltamapping</span><span class="p">(</span>
    <span class="n">simulation</span><span class="p">,</span>
    <span class="n">variable</span><span class="p">,</span>
    <span class="n">qdm</span><span class="p">,</span>
    <span class="n">years</span><span class="p">,</span>
    <span class="n">astype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">quantile_variable</span><span class="o">=</span><span class="s2">&quot;sim_q&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply QDM to adjust a range of years within a simulation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    simulation : xr.Dataset</span>
<span class="sd">        Daily simulation data to be adjusted. Must have sufficient observations</span>
<span class="sd">        around `year` to adjust. Target variable must have a units attribute.</span>
<span class="sd">    variable : str</span>
<span class="sd">        Target variable in `simulation` to adjust. Adjusted output will</span>
<span class="sd">        share the same name.</span>
<span class="sd">    qdm : xr.Dataset or sdba.adjustment.QuantileDeltaMapping</span>
<span class="sd">        Trained ``xclim.sdba.adjustment.QuantileDeltaMapping``, or Dataset</span>
<span class="sd">        representation that will be instantiate</span>
<span class="sd">        ``xclim.sdba.adjustment.QuantileDeltaMapping``.</span>
<span class="sd">    years : sequence of ints</span>
<span class="sd">        Years of simulation to adjust, with rolling years and day grouping.</span>
<span class="sd">    astype : str, numpy.dtype, or None, optional</span>
<span class="sd">        Typecode or data-type to which the regridded output is cast.</span>
<span class="sd">    quantile_variable : str or None, optional</span>
<span class="sd">        Name of quantile coordinate to reset to data variable. Not reset</span>
<span class="sd">        if ``None``.</span>
<span class="sd">    kwargs :</span>
<span class="sd">        Keyword arguments passed to</span>
<span class="sd">        ``dodola.core.adjust_quantiledeltamapping_year``.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : xr.Dataset</span>
<span class="sd">        QDM-adjusted values from `simulation`. May be a lazy-evaluated future, not</span>
<span class="sd">        yet computed. In addition to adjusted original variables, this includes</span>
<span class="sd">        &quot;sim_q&quot; variable giving quantiles from QDM biasadjustment.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># This loop is a candidate for dask.delayed. Beware, xclim had issues with saturated scheduler.</span>
    <span class="n">qdm_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">yr</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
        <span class="n">adj</span> <span class="o">=</span> <span class="n">adjust_quantiledeltamapping_year</span><span class="p">(</span>
            <span class="n">simulation</span><span class="o">=</span><span class="n">simulation</span><span class="p">,</span> <span class="n">qdm</span><span class="o">=</span><span class="n">qdm</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">yr</span><span class="p">,</span> <span class="n">variable</span><span class="o">=</span><span class="n">variable</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">astype</span><span class="p">:</span>
            <span class="n">adj</span> <span class="o">=</span> <span class="n">adj</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">astype</span><span class="p">)</span>
        <span class="n">qdm_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adj</span><span class="p">)</span>

    <span class="c1"># Combine years and ensure output matches input data dimension order.</span>
    <span class="n">adjusted_ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">qdm_list</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="o">*</span><span class="n">simulation</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">quantile_variable</span><span class="p">:</span>
        <span class="n">adjusted_ds</span> <span class="o">=</span> <span class="n">adjusted_ds</span><span class="o">.</span><span class="n">reset_coords</span><span class="p">(</span><span class="n">quantile_variable</span><span class="p">)</span>
        <span class="c1"># Analysts said sim_q needed no attrs.</span>
        <span class="n">adjusted_ds</span><span class="p">[</span><span class="n">quantile_variable</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Overwrite QDM output attrs with input simulation attrs.</span>
    <span class="n">adjusted_ds</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">attrs</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">simulation</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">adjusted_ds</span><span class="p">:</span>
            <span class="n">adjusted_ds</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">attrs</span>

    <span class="k">return</span> <span class="n">adjusted_ds</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.core.adjust_quantiledeltamapping_year" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.core.adjust_quantiledeltamapping_year</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">adjust_quantiledeltamapping_year</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">qdm</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">halfyearwindow_n</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">include_quantiles</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Apply QDM to adjust a year within a simulation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>simulation</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Daily simulation data to be adjusted. Must have sufficient observations
around <code>year</code> to adjust. Target variable must have a units attribute.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>qdm</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span> or <span title="xclim.sdba.adjustment.QuantileDeltaMapping">QuantileDeltaMapping</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Trained <code>xclim.sdba.adjustment.QuantileDeltaMapping</code>, or
Dataset representation that will be instantiate
<code>xclim.sdba.adjustment.QuantileDeltaMapping</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>year</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target year to adjust, with rolling years and day grouping.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>variable</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target variable in <code>simulation</code> to adjust. Adjusted output will share the
same name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>halfyearwindow_n</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Half-length of the annual rolling window to extract along either
side of <code>year</code>.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>include_quantiles</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to output quantiles (sim_q) as a coordinate on
the bias corrected data variable in output.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out</code></td>            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>QDM-adjusted values from <code>simulation</code>. May be a lazy-evaluated future, not
yet computed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>dodola/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">adjust_quantiledeltamapping_year</span><span class="p">(</span>
    <span class="n">simulation</span><span class="p">,</span> <span class="n">qdm</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">halfyearwindow_n</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">include_quantiles</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply QDM to adjust a year within a simulation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    simulation : xr.Dataset</span>
<span class="sd">        Daily simulation data to be adjusted. Must have sufficient observations</span>
<span class="sd">        around `year` to adjust. Target variable must have a units attribute.</span>
<span class="sd">    qdm : xr.Dataset or sdba.adjustment.QuantileDeltaMapping</span>
<span class="sd">        Trained ``xclim.sdba.adjustment.QuantileDeltaMapping``, or</span>
<span class="sd">        Dataset representation that will be instantiate</span>
<span class="sd">        ``xclim.sdba.adjustment.QuantileDeltaMapping``.</span>
<span class="sd">    year : int</span>
<span class="sd">        Target year to adjust, with rolling years and day grouping.</span>
<span class="sd">    variable : str</span>
<span class="sd">        Target variable in `simulation` to adjust. Adjusted output will share the</span>
<span class="sd">        same name.</span>
<span class="sd">    halfyearwindow_n : int, optional</span>
<span class="sd">        Half-length of the annual rolling window to extract along either</span>
<span class="sd">        side of `year`.</span>
<span class="sd">    include_quantiles : bool, optional</span>
<span class="sd">        Whether or not to output quantiles (sim_q) as a coordinate on</span>
<span class="sd">        the bias corrected data variable in output.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out : xr.Dataset</span>
<span class="sd">        QDM-adjusted values from `simulation`. May be a lazy-evaluated future, not</span>
<span class="sd">        yet computed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
    <span class="n">variable</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
    <span class="n">halfyearwindow_n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">halfyearwindow_n</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">qdm</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
        <span class="n">qdm</span> <span class="o">=</span> <span class="n">sdba</span><span class="o">.</span><span class="n">adjustment</span><span class="o">.</span><span class="n">QuantileDeltaMapping</span><span class="o">.</span><span class="n">from_dataset</span><span class="p">(</span><span class="n">qdm</span><span class="p">)</span>

    <span class="c1"># Slice to get 15 days before and after our target year. This accounts</span>
    <span class="c1"># for the rolling 31 day rolling window.</span>
    <span class="n">timeslice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">halfyearwindow_n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">-12-17&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">halfyearwindow_n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">-01-15&quot;</span>
    <span class="p">)</span>
    <span class="n">simulation</span> <span class="o">=</span> <span class="n">simulation</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span>
        <span class="n">time</span><span class="o">=</span><span class="n">timeslice</span>
    <span class="p">)</span>  <span class="c1"># TODO: Need a check to ensure we have all the data in this slice!</span>
    <span class="k">if</span> <span class="n">include_quantiles</span><span class="p">:</span>
        <span class="c1"># include quantile information in output</span>
        <span class="k">with</span> <span class="n">set_options</span><span class="p">(</span><span class="n">sdba_extra_output</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">qdm</span><span class="o">.</span><span class="n">adjust</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">))</span>
            <span class="c1"># make quantiles a coordinate of bias corrected output variable</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s2">&quot;scen&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">sim_q</span><span class="o">=</span><span class="n">out</span><span class="o">.</span><span class="n">sim_q</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">qdm</span><span class="o">.</span><span class="n">adjust</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">variable</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.core.apply_precip_ceiling" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.core.apply_precip_ceiling</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">apply_precip_ceiling</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ceiling</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Converts all precip values above a threshold to the threshold value, uniformly across space and time.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ds</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ceiling</code>
            </td>
            <td>
                  <code><span title="int">int</span> or <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>dodola/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">apply_precip_ceiling</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ceiling</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts all precip values above a threshold to the threshold value, uniformly across space and time.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds : xr.Dataset</span>
<span class="sd">    ceiling : int or float</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xr.Dataset</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds_corrected</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds</span> <span class="o">&lt;=</span> <span class="n">ceiling</span><span class="p">,</span> <span class="n">ceiling</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds_corrected</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.core.apply_wet_day_frequency_correction" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.core.apply_wet_day_frequency_correction</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">apply_wet_day_frequency_correction</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">variable</span><span class="o">=</span><span class="s1">&#39;pr&#39;</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ds</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>process</code>
            </td>
            <td>
                  <code>(<span title="pre">pre</span>, <span title="post">post</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>&#34;pre&#34;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>variable</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>&#39;pr&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>[1] A.J. Cannon, S.R. Sobie, and T.Q. Murdock (2015), "Bias correction of GCM
    precipitation by quantile mapping: How well do methods preserve
    changes in quantiles and extremes?", Journal of Climate, vol.
    28, Issue 7, pp. 6938-6959.
[2] S. Hempel, K. Frieler, L. Warszawski, J. Schewe, and F. Piotek (2013), "A trend-preserving bias correction - The ISI-MIP approach", Earth Syst. Dynam. vol. 4, pp. 219-236.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>dodola/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">apply_wet_day_frequency_correction</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">variable</span><span class="o">=</span><span class="s2">&quot;pr&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds : xr.Dataset</span>
<span class="sd">    process : {&quot;pre&quot;, &quot;post&quot;}</span>
<span class="sd">    variable: str</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xr.Dataset</span>

<span class="sd">    Notes</span>
<span class="sd">    -------</span>
<span class="sd">    [1] A.J. Cannon, S.R. Sobie, and T.Q. Murdock (2015), &quot;Bias correction of GCM</span>
<span class="sd">        precipitation by quantile mapping: How well do methods preserve</span>
<span class="sd">        changes in quantiles and extremes?&quot;, Journal of Climate, vol.</span>
<span class="sd">        28, Issue 7, pp. 6938-6959.</span>
<span class="sd">    [2] S. Hempel, K. Frieler, L. Warszawski, J. Schewe, and F. Piotek (2013), &quot;A trend-preserving bias correction - The ISI-MIP approach&quot;, Earth Syst. Dynam. vol. 4, pp. 219-236.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># threshold from Hempel et al 2013</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># mm/day</span>
    <span class="c1"># adjusted &quot;low&quot; value from the original epsilon in Cannon et al 2015 to</span>
    <span class="c1"># avoid having some values get extremely large</span>
    <span class="n">low</span> <span class="o">=</span> <span class="n">threshold</span> <span class="o">/</span> <span class="mf">2.0</span>

    <span class="k">if</span> <span class="n">process</span> <span class="o">==</span> <span class="s2">&quot;pre&quot;</span><span class="p">:</span>
        <span class="c1"># includes very small values that are negative in CMIP6 output</span>
        <span class="n">ds</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">ds</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
                <span class="n">low</span><span class="o">=</span><span class="n">low</span><span class="p">,</span>
                <span class="n">high</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="n">ds</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">process</span> <span class="o">==</span> <span class="s2">&quot;post&quot;</span><span class="p">:</span>
        <span class="n">ds</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;this processing option is not implemented&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.core.dtr_floor" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.core.dtr_floor</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">dtr_floor</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">floor</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Converts all diurnal temperature range (DTR) values strictly below a floor
to that floor.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ds</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>floor</code>
            </td>
            <td>
                  <code><span title="int">int</span> or <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>dodola/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">dtr_floor</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">floor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts all diurnal temperature range (DTR) values strictly below a floor</span>
<span class="sd">    to that floor.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds : xr.Dataset</span>
<span class="sd">    floor : int or float</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xr.Dataset</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ds_corrected</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds</span> <span class="o">&gt;=</span> <span class="n">floor</span><span class="p">,</span> <span class="n">floor</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds_corrected</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.core.non_polar_dtr_ceiling" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.core.non_polar_dtr_ceiling</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">non_polar_dtr_ceiling</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ceiling</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Converts all non-polar (regions between the 60th south and north parallel) diurnal temperature range (DTR) values strictly above a ceiling
to that ceiling.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ds</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ceiling</code>
            </td>
            <td>
                  <code><span title="int">int</span> or <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>dodola/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">non_polar_dtr_ceiling</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ceiling</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts all non-polar (regions between the 60th south and north parallel) diurnal temperature range (DTR) values strictly above a ceiling</span>
<span class="sd">    to that ceiling.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds : xr.Dataset</span>
<span class="sd">    ceiling : int or float</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xr.Dataset</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ds_corrected</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">xr</span><span class="o">.</span><span class="n">ufuncs</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span>
            <span class="n">ds</span> <span class="o">&lt;=</span> <span class="n">ceiling</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">ufuncs</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="n">ceiling</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">ds_corrected</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.core.standardize_gcm" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.core.standardize_gcm</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">standardize_gcm</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">leapday_removal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>360 calendar conversion requires that there are no chunks in
the 'time' dimension of <code>ds</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ds</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>leapday_removal</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>dodola/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">standardize_gcm</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">leapday_removal</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    360 calendar conversion requires that there are no chunks in</span>
<span class="sd">    the &#39;time&#39; dimension of `ds`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds : xr.Dataset</span>
<span class="sd">    leapday_removal : bool, optional</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xr.Dataset</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Remove cruft coordinates, variables, dims.</span>
    <span class="n">cruft_vars</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="s2">&quot;member_id&quot;</span><span class="p">,</span> <span class="s2">&quot;time_bnds&quot;</span><span class="p">)</span>

    <span class="n">dims_to_squeeze</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">coords_to_drop</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cruft_vars</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span>
            <span class="n">dims_to_squeeze</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
            <span class="n">coords_to_drop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="n">ds_cleaned</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">dims_to_squeeze</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reset_coords</span><span class="p">(</span>
        <span class="n">coords_to_drop</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># Cleanup time.</span>

    <span class="c1"># if variable is precip, need to update units to mm day-1</span>
    <span class="k">if</span> <span class="s2">&quot;pr&quot;</span> <span class="ow">in</span> <span class="n">ds_cleaned</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
        <span class="c1"># units should be kg/m2/s in CMIP6 output</span>
        <span class="k">if</span> <span class="n">ds_cleaned</span><span class="p">[</span><span class="s2">&quot;pr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;kg m-2 s-1&quot;</span><span class="p">:</span>
            <span class="c1"># convert to mm/day</span>
            <span class="n">mmday_conversion</span> <span class="o">=</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span>
            <span class="n">ds_cleaned</span><span class="p">[</span><span class="s2">&quot;pr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_cleaned</span><span class="p">[</span><span class="s2">&quot;pr&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">mmday_conversion</span>
            <span class="c1"># update units attribute</span>
            <span class="n">ds_cleaned</span><span class="p">[</span><span class="s2">&quot;pr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mm day-1&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># we want this to fail, as pr units are something we don&#39;t expect</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;check units: pr units attribute is not kg m-2 s-1&quot;</span><span class="p">)</span>

    <span class="n">cal</span> <span class="o">=</span> <span class="n">get_calendar</span><span class="p">(</span><span class="n">ds_cleaned</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="n">cal</span> <span class="o">==</span> <span class="s2">&quot;360_day&quot;</span> <span class="ow">or</span> <span class="n">leapday_removal</span>
    <span class="p">):</span>  <span class="c1"># calendar conversion is necessary in either case</span>
        <span class="c1"># if calendar is just integers, xclim cannot understand it</span>
        <span class="k">if</span> <span class="n">ds_cleaned</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;int64&quot;</span><span class="p">:</span>
            <span class="n">ds_cleaned</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">decode_cf</span><span class="p">(</span><span class="n">ds_cleaned</span><span class="p">)</span><span class="o">.</span><span class="n">time</span>
        <span class="k">if</span> <span class="n">cal</span> <span class="o">==</span> <span class="s2">&quot;360_day&quot;</span><span class="p">:</span>
            <span class="c1"># Cannot have chunks in time dimension for 360 day calendar conversion so loading</span>
            <span class="c1"># data into memory.</span>
            <span class="n">ds_cleaned</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">leapday_removal</span><span class="p">:</span>  <span class="c1"># 360 day -&gt; noleap</span>
                <span class="n">ds_converted</span> <span class="o">=</span> <span class="n">xclim_convert_360day_calendar_interpolate</span><span class="p">(</span>
                    <span class="n">ds</span><span class="o">=</span><span class="n">ds_cleaned</span><span class="p">,</span>
                    <span class="n">target</span><span class="o">=</span><span class="s2">&quot;noleap&quot;</span><span class="p">,</span>
                    <span class="n">align_on</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span>
                    <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># 360 day -&gt; standard</span>
                <span class="n">ds_converted</span> <span class="o">=</span> <span class="n">xclim_convert_360day_calendar_interpolate</span><span class="p">(</span>
                    <span class="n">ds</span><span class="o">=</span><span class="n">ds_cleaned</span><span class="p">,</span>
                    <span class="n">target</span><span class="o">=</span><span class="s2">&quot;standard&quot;</span><span class="p">,</span>
                    <span class="n">align_on</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span>
                    <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># any -&gt; noleap</span>
            <span class="c1"># remove leap days and update calendar</span>
            <span class="n">ds_converted</span> <span class="o">=</span> <span class="n">xclim_remove_leapdays</span><span class="p">(</span><span class="n">ds_cleaned</span><span class="p">)</span>

        <span class="c1"># rechunk, otherwise chunks are different sizes</span>
        <span class="n">ds_out</span> <span class="o">=</span> <span class="n">ds_converted</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="mi">730</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds_cleaned</span><span class="o">.</span><span class="n">lat</span><span class="p">),</span> <span class="s2">&quot;lon&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds_cleaned</span><span class="o">.</span><span class="n">lon</span><span class="p">)}</span>
        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">ds_out</span> <span class="o">=</span> <span class="n">ds_cleaned</span>

    <span class="k">return</span> <span class="n">ds_out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.core.test_dtr_range" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.core.test_dtr_range</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">test_dtr_range</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">data_type</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Ensure DTR values are in a valid range
Test polar values separately since some polar values can be much higher post bias adjustment.</p>


            <details class="quote">
              <summary>Source code in <code>dodola/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_dtr_range</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">data_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensure DTR values are in a valid range</span>
<span class="sd">    Test polar values separately since some polar values can be much higher post bias adjustment.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># test that DTR values are greater than 0 or equal to 0 depending on the data type</span>
    <span class="c1"># note that some CMIP6 DTR will equal 0 at polar latitudes, this will be adjusted</span>
    <span class="c1"># before bias adjustment with the DTR small values correction</span>

    <span class="n">dtr_min</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;cmip6&quot;</span><span class="p">:</span>
        <span class="c1"># may be equal to zero in polar regions and if tasmax &lt; tasmin (only occurs for GFDL models)</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">dtr_min</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="p">),</span> <span class="s2">&quot;diurnal temperature range minimum is </span><span class="si">{}</span><span class="s2"> and thus not greater than or equal to 0 for CMIP6&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">dtr_min</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># this must be greater than 0 for bias corrected and downscaled</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">dtr_min</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">),</span> <span class="s2">&quot;diurnal temperature range minimum is </span><span class="si">{}</span><span class="s2"> and must be greater than zero&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">dtr_min</span>
        <span class="p">)</span>

    <span class="c1"># test polar DTR values</span>
    <span class="n">southern_polar_max</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">southern_polar_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">southern_polar_max</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">southern_polar_max</span> <span class="o">&lt;</span> <span class="mi">100</span>
        <span class="p">),</span> <span class="s2">&quot;diurnal temperature range max is </span><span class="si">{}</span><span class="s2"> for polar southern latitudes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">southern_polar_max</span>
        <span class="p">)</span>

    <span class="n">northern_polar_max</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">northern_polar_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">northern_polar_max</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">northern_polar_max</span> <span class="o">&lt;</span> <span class="mi">100</span>
        <span class="p">),</span> <span class="s2">&quot;diurnal temperature range max is </span><span class="si">{}</span><span class="s2"> for polar northern latitudes&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">northern_polar_max</span>
        <span class="p">)</span>

    <span class="c1"># test all but polar regions</span>
    <span class="n">non_polar_max</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">ds</span><span class="o">.</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">60</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">non_polar_max</span> <span class="o">&lt;=</span> <span class="mi">70</span>
    <span class="p">),</span> <span class="s2">&quot;diurnal temperature range max is </span><span class="si">{}</span><span class="s2"> for non-polar regions&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">non_polar_max</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.core.test_for_nans" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.core.test_for_nans</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">test_for_nans</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Tests for presence of NaNs</p>


            <details class="quote">
              <summary>Source code in <code>dodola/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_for_nans</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests for presence of NaNs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;there are nans!&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.core.test_maximum_precip" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.core.test_maximum_precip</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">test_maximum_precip</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Tests that max precip is reasonable</p>


            <details class="quote">
              <summary>Source code in <code>dodola/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_maximum_precip</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests that max precip is reasonable</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="mi">3000</span>  <span class="c1"># in mm, max observed is 1.825m --&gt; maximum occurs between 0.5-0.8</span>
    <span class="n">max_precip</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
    <span class="n">num_precip_values_over_threshold</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">num_precip_values_over_threshold</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="p">),</span> <span class="s2">&quot;maximum precip is </span><span class="si">{}</span><span class="s2"> mm and there are </span><span class="si">{}</span><span class="s2"> values over 3000mm&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">max_precip</span><span class="p">,</span> <span class="n">num_precip_values_over_threshold</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.core.test_negative_values" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.core.test_negative_values</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">test_negative_values</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Tests for presence of negative values</p>


            <details class="quote">
              <summary>Source code in <code>dodola/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_negative_values</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests for presence of negative values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># this is not set to 0 to deal with floating point error</span>
    <span class="n">neg_values</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.001</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">neg_values</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;there are </span><span class="si">{}</span><span class="s2"> negative values!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">neg_values</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.core.test_temp_range" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.core.test_temp_range</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">test_temp_range</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Ensure temperature values are in a valid range</p>


            <details class="quote">
              <summary>Source code in <code>dodola/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_temp_range</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensure temperature values are in a valid range</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># This high 377 K temperature range is to allow UKESM1-0-LL runs, which</span>
    <span class="c1"># apparently run very hot.</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">130</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">377</span>
    <span class="p">),</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> values are invalid&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.core.test_timesteps" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.core.test_timesteps</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">test_timesteps</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">time_period</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Tests that Dataset contains the correct number of timesteps (number of days on a noleap calendar)
for the data_type/time_period combination.</p>


            <details class="quote">
              <summary>Source code in <code>dodola/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_timesteps</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">time_period</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests that Dataset contains the correct number of timesteps (number of days on a noleap calendar)</span>
<span class="sd">    for the data_type/time_period combination.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">time_period</span> <span class="o">==</span> <span class="s2">&quot;future&quot;</span><span class="p">:</span>
        <span class="c1"># bias corrected/downscaled data has 2015 - 2099 or 2100 depending on the model</span>
        <span class="c1"># CMIP6 future data has an additional ten years from the historical model run</span>
        <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;cmip6&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">35040</span>  <span class="c1"># some CMIP6 data ends in 2099</span>
            <span class="p">),</span> <span class="s2">&quot;projection </span><span class="si">{}</span><span class="s2"> file is missing timesteps, has </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">data_type</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">35405</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;projection </span><span class="si">{}</span><span class="s2"> file has excess timesteps, has </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">data_type</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">31025</span>  <span class="c1"># 2015 - 2099</span>
            <span class="p">),</span> <span class="s2">&quot;projection </span><span class="si">{}</span><span class="s2"> file is missing timesteps, has </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">data_type</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">31390</span><span class="p">:</span>  <span class="c1"># 2015 - 2100</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;projection </span><span class="si">{}</span><span class="s2"> file has excess timesteps, has </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">data_type</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>

    <span class="k">elif</span> <span class="n">time_period</span> <span class="o">==</span> <span class="s2">&quot;historical&quot;</span><span class="p">:</span>
        <span class="c1"># bias corrected/downscaled data should have 1950 - 2014</span>
        <span class="c1"># CMIP6 historical data has an additional ten years from SSP 370 (or 245 if 370 not available)</span>
        <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;cmip6&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">27740</span>
            <span class="p">),</span> <span class="s2">&quot;historical </span><span class="si">{}</span><span class="s2"> file is missing timesteps, has </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">data_type</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">27740</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;historical </span><span class="si">{}</span><span class="s2"> file has excess timesteps, has </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">data_type</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">23725</span>
            <span class="p">),</span> <span class="s2">&quot;historical </span><span class="si">{}</span><span class="s2"> file is missing timesteps, has </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">data_type</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">23725</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;historical </span><span class="si">{}</span><span class="s2"> file has excess timesteps, has </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">data_type</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.core.test_variable_names" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.core.test_variable_names</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">test_variable_names</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Test that the correct variable name exists in the file</p>


            <details class="quote">
              <summary>Source code in <code>dodola/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_variable_names</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test that the correct variable name exists in the file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">var</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> not in Dataset&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.core.train_analogdownscaling" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.core.train_analogdownscaling</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">train_analogdownscaling</span><span class="p">(</span><span class="n">coarse_reference</span><span class="p">,</span> <span class="n">fine_reference</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">quantiles_n</span><span class="o">=</span><span class="mi">620</span><span class="p">,</span> <span class="n">window_n</span><span class="o">=</span><span class="mi">31</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Train Quantile-Preserving, Localized Analogs Downscaling (QPLAD)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>coarse_reference</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset to use as resampled (to fine resolution) coarse reference.Target variable must have a units attribute.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fine_reference</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset to use as fine-resolution reference. Target variable must have a units attribute.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>variable</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of target variable to extract from <code>coarse_reference</code> and <code>fine_reference</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kind</code>
            </td>
            <td>
                  <code>(&#39;+&#39;, &#39;*&#39;)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Kind of variable. Used for creating QPLAD adjustment factors.</p>
              </div>
            </td>
            <td>
                  <code>&#34;+&#34;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>quantiles_n</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of quantiles for QPLAD.</p>
              </div>
            </td>
            <td>
                  <code>620</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>window_n</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Centered window size for day-of-year grouping.</p>
              </div>
            </td>
            <td>
                  <code>31</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xclim.sdba.adjustment.QuantilePreservingAnalogDownscaling">QuantilePreservingAnalogDownscaling</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>dodola/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">train_analogdownscaling</span><span class="p">(</span>
    <span class="n">coarse_reference</span><span class="p">,</span> <span class="n">fine_reference</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">quantiles_n</span><span class="o">=</span><span class="mi">620</span><span class="p">,</span> <span class="n">window_n</span><span class="o">=</span><span class="mi">31</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Train Quantile-Preserving, Localized Analogs Downscaling (QPLAD)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    coarse_reference : xr.Dataset</span>
<span class="sd">        Dataset to use as resampled (to fine resolution) coarse reference.Target variable must have a units attribute.</span>
<span class="sd">    fine_reference : xr.Dataset</span>
<span class="sd">        Dataset to use as fine-resolution reference. Target variable must have a units attribute.</span>
<span class="sd">    variable : str</span>
<span class="sd">        Name of target variable to extract from `coarse_reference` and `fine_reference`.</span>
<span class="sd">    kind : {&quot;+&quot;, &quot;*&quot;}</span>
<span class="sd">        Kind of variable. Used for creating QPLAD adjustment factors.</span>
<span class="sd">    quantiles_n : int, optional</span>
<span class="sd">        Number of quantiles for QPLAD.</span>
<span class="sd">    window_n : int, optional</span>
<span class="sd">        Centered window size for day-of-year grouping.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xclim.sdba.adjustment.QuantilePreservingAnalogDownscaling</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># QPLAD method requires that the number of quantiles equals</span>
    <span class="c1"># the number of days in each day group</span>
    <span class="c1"># e.g. 20 years of data and a window of 31 = 620 quantiles</span>

    <span class="c1"># check that lengths of input data are the same, then only check years for one</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coarse_reference</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fine_reference</span><span class="o">.</span><span class="n">time</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;coarse and fine reference data inputs have different lengths&quot;</span><span class="p">)</span>

    <span class="c1"># check number of years in input data (subtract 2 for the +/- 15 days on each end)</span>
    <span class="n">num_years</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">fine_reference</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">))</span> <span class="o">-</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">num_years</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">window_n</span><span class="p">))</span> <span class="o">!=</span> <span class="n">quantiles_n</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;number of quantiles </span><span class="si">{}</span><span class="s2"> must equal # of years </span><span class="si">{}</span><span class="s2"> * window length </span><span class="si">{}</span><span class="s2">, day groups must </span><span class="si">{}</span><span class="s2"> days&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">quantiles_n</span><span class="p">,</span> <span class="n">num_years</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">window_n</span><span class="p">),</span> <span class="n">quantiles_n</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="n">qplad</span> <span class="o">=</span> <span class="n">sdba</span><span class="o">.</span><span class="n">adjustment</span><span class="o">.</span><span class="n">QuantilePreservingAnalogDownscaling</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
        <span class="n">ref</span><span class="o">=</span><span class="n">coarse_reference</span><span class="p">[</span><span class="n">variable</span><span class="p">],</span>
        <span class="n">hist</span><span class="o">=</span><span class="n">fine_reference</span><span class="p">[</span><span class="n">variable</span><span class="p">],</span>
        <span class="n">kind</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">kind</span><span class="p">),</span>
        <span class="n">group</span><span class="o">=</span><span class="n">sdba</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="s2">&quot;time.dayofyear&quot;</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">window_n</span><span class="p">)),</span>
        <span class="n">nquantiles</span><span class="o">=</span><span class="n">quantiles_n</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">qplad</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.core.train_quantiledeltamapping" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.core.train_quantiledeltamapping</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">train_quantiledeltamapping</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">historical</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">quantiles_n</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">window_n</span><span class="o">=</span><span class="mi">31</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Train quantile delta mapping</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>reference</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset to use as model reference. Target variable must have a units attribute.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>historical</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset to use as historical simulation. Target variable must have a units attribute.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>variable</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of target variable to extract from <code>historical</code> and <code>reference</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kind</code>
            </td>
            <td>
                  <code>(&#39;+&#39;, &#39;*&#39;)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Kind of variable. Used for QDM scaling.</p>
              </div>
            </td>
            <td>
                  <code>&#34;+&#34;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>quantiles_n</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of quantiles for QDM.</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>window_n</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Centered window size for day-of-year grouping.</p>
              </div>
            </td>
            <td>
                  <code>31</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xclim.sdba.adjustment.QuantileDeltaMapping">QuantileDeltaMapping</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>dodola/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">train_quantiledeltamapping</span><span class="p">(</span>
    <span class="n">reference</span><span class="p">,</span> <span class="n">historical</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">quantiles_n</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">window_n</span><span class="o">=</span><span class="mi">31</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Train quantile delta mapping</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    reference : xr.Dataset</span>
<span class="sd">        Dataset to use as model reference. Target variable must have a units attribute.</span>
<span class="sd">    historical : xr.Dataset</span>
<span class="sd">        Dataset to use as historical simulation. Target variable must have a units attribute.</span>
<span class="sd">    variable : str</span>
<span class="sd">        Name of target variable to extract from `historical` and `reference`.</span>
<span class="sd">    kind : {&quot;+&quot;, &quot;*&quot;}</span>
<span class="sd">        Kind of variable. Used for QDM scaling.</span>
<span class="sd">    quantiles_n : int, optional</span>
<span class="sd">        Number of quantiles for QDM.</span>
<span class="sd">    window_n : int, optional</span>
<span class="sd">        Centered window size for day-of-year grouping.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xclim.sdba.adjustment.QuantileDeltaMapping</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">qdm</span> <span class="o">=</span> <span class="n">sdba</span><span class="o">.</span><span class="n">adjustment</span><span class="o">.</span><span class="n">QuantileDeltaMapping</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
        <span class="n">ref</span><span class="o">=</span><span class="n">reference</span><span class="p">[</span><span class="n">variable</span><span class="p">],</span>
        <span class="n">hist</span><span class="o">=</span><span class="n">historical</span><span class="p">[</span><span class="n">variable</span><span class="p">],</span>
        <span class="n">kind</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">kind</span><span class="p">),</span>
        <span class="n">group</span><span class="o">=</span><span class="n">sdba</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="s2">&quot;time.dayofyear&quot;</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">window_n</span><span class="p">)),</span>
        <span class="n">nquantiles</span><span class="o">=</span><span class="n">equally_spaced_nodes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">quantiles_n</span><span class="p">),</span> <span class="n">eps</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">qdm</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.core.xclim_convert_360day_calendar_interpolate" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.core.xclim_convert_360day_calendar_interpolate</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">xclim_convert_360day_calendar_interpolate</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;noleap&#39;</span><span class="p">,</span> <span class="n">align_on</span><span class="o">=</span><span class="s1">&#39;random&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">return_indices</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ignore_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ds</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>see xclim.core.calendar.convert_calendar</p>
              </div>
            </td>
            <td>
                  <code>&#39;noleap&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>align_on</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>this determines which days in the calendar will have missing values or will be the product of interpolation, if there is.
It could be every year the same calendar days, or the days could randomly change. see xclim.core.calendar.convert_calendar</p>
              </div>
            </td>
            <td>
                  <code>&#39;random&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interpolation</code>
            </td>
            <td>
                  <code>None or <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>passed to xr.Dataset.interpolate_na if not None</p>
              </div>
            </td>
            <td>
                  <code>&#39;linear&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_indices</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>on top of the converted dataset, return a list of the array indices identifying values that were inserted.
This assumes there were no NaNs before conversion.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ignore_nans</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if False and there are any NaNs in <code>ds</code> variables, an assertion error will be raised. NaNs are ignored otherwise.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple(xr.Dataset, xr.Dataset) if return_indices is True, xr.Dataset otherwise.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>The default values of <code>target</code>, <code>align_on</code> and <code>interpolation</code> mean that our default approach is equivalent to that of the LOCA
calendar conversion [1] for conversion from 360 days calendars to noleap calendars. In that approach, 5 calendar days are added (noleap
calendars always have 365 days) to each year. But those calendar days are not necessarily those that will have their value be the product
of interpolation. The days for which we interpolate are selected randomly every block of 72 days, so that they change every year.</p>
<p>[1] http://loca.ucsd.edu/loca-calendar/</p>
</details>

            <details class="quote">
              <summary>Source code in <code>dodola/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">xclim_convert_360day_calendar_interpolate</span><span class="p">(</span>
    <span class="n">ds</span><span class="p">,</span>
    <span class="n">target</span><span class="o">=</span><span class="s2">&quot;noleap&quot;</span><span class="p">,</span>
    <span class="n">align_on</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span>
    <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="n">return_indices</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">ignore_nans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds : xr.Dataset</span>
<span class="sd">    target : str</span>
<span class="sd">        see xclim.core.calendar.convert_calendar</span>
<span class="sd">    align_on : str</span>
<span class="sd">        this determines which days in the calendar will have missing values or will be the product of interpolation, if there is.</span>
<span class="sd">        It could be every year the same calendar days, or the days could randomly change. see xclim.core.calendar.convert_calendar</span>
<span class="sd">    interpolation : None or str</span>
<span class="sd">        passed to xr.Dataset.interpolate_na if not None</span>
<span class="sd">    return_indices : bool</span>
<span class="sd">        on top of the converted dataset, return a list of the array indices identifying values that were inserted.</span>
<span class="sd">        This assumes there were no NaNs before conversion.</span>
<span class="sd">    ignore_nans : bool</span>
<span class="sd">        if False and there are any NaNs in `ds` variables, an assertion error will be raised. NaNs are ignored otherwise.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple(xr.Dataset, xr.Dataset) if return_indices is True, xr.Dataset otherwise.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The default values of `target`, `align_on` and `interpolation` mean that our default approach is equivalent to that of the LOCA</span>
<span class="sd">    calendar conversion [1] for conversion from 360 days calendars to noleap calendars. In that approach, 5 calendar days are added (noleap</span>
<span class="sd">    calendars always have 365 days) to each year. But those calendar days are not necessarily those that will have their value be the product</span>
<span class="sd">    of interpolation. The days for which we interpolate are selected randomly every block of 72 days, so that they change every year.</span>

<span class="sd">    [1] http://loca.ucsd.edu/loca-calendar/</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">get_calendar</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;360_day&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;tried to use 360 day calendar conversion for a non-360-day calendar dataset&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_nans</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="p">),</span> <span class="s2">&quot;360 days calendar conversion with interpolation : there are nans !&quot;</span>

    <span class="n">ds_converted</span> <span class="o">=</span> <span class="n">convert_calendar</span><span class="p">(</span>
        <span class="n">ds</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">align_on</span><span class="o">=</span><span class="n">align_on</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">interpolation</span><span class="p">:</span>
        <span class="n">ds_out</span> <span class="o">=</span> <span class="n">ds_converted</span><span class="o">.</span><span class="n">interpolate_na</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ds_out</span> <span class="o">=</span> <span class="n">ds_converted</span>

    <span class="k">if</span> <span class="n">return_indices</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ds_out</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">ufuncs</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ds_converted</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ds_out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.core.xclim_remove_leapdays" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.core.xclim_remove_leapdays</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">xclim_remove_leapdays</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ds</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>dodola/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">xclim_remove_leapdays</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds : xr.Dataset</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xr.Dataset</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds_noleap</span> <span class="o">=</span> <span class="n">convert_calendar</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;noleap&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds_noleap</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.core.xclim_units_any2pint" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.core.xclim_units_any2pint</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">xclim_units_any2pint</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ds</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>var</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>xr.Dataset with `var` units str attribute converted to xclim&#39;s pint registry format</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>dodola/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">xclim_units_any2pint</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds : xr.Dataset</span>
<span class="sd">    var : str</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xr.Dataset with `var` units str attribute converted to xclim&#39;s pint registry format</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reformatting </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2"> unit string representation&quot;</span><span class="p">)</span>
    <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">xclim_units</span><span class="o">.</span><span class="n">units2pint</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">ds</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.core.xclim_units_pint2cf" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.core.xclim_units_pint2cf</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">xclim_units_pint2cf</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ds</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>var</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>xr.Dataset with `var` units str attribute converted to CF format</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>dodola/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">xclim_units_pint2cf</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ds : xr.Dataset</span>
<span class="sd">    var : str</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xr.Dataset with `var` units str attribute converted to CF format</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reformatting </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2"> unit string representation&quot;</span><span class="p">)</span>
    <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xclim_units</span><span class="o">.</span><span class="n">pint2cfunits</span><span class="p">(</span>
        <span class="n">xclim_units</span><span class="o">.</span><span class="n">units2pint</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">])</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">ds</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="dodola.core.xesmf_regrid" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dodola.core.xesmf_regrid</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">xesmf_regrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">weights_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">astype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_cyclic</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Regrid a Dataset.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>domain</code>
            </td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Domain to regrid to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Method of regridding. Passed to <code>xesmf.Regridder</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>weights_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Local path to netCDF file of pre-calculated XESMF regridding weights.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>astype</code>
            </td>
            <td>
                  <code>str, numpy.dtype, or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Typecode or data-type to which the regridded output is cast.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>add_cyclic</code>
            </td>
            <td>
                  <code>str, or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Add cyclic point (aka wrap-around pixel) to given dimension before
regridding. Useful for avoiding dateline artifacts along longitude
in global datasets.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>keep_attrs</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to pass attrs from input to regridded output.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>dodola/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">xesmf_regrid</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">weights_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">astype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_cyclic</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Regrid a Dataset.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : xr.Dataset</span>
<span class="sd">    domain : xr.Dataset</span>
<span class="sd">        Domain to regrid to.</span>
<span class="sd">    method : str</span>
<span class="sd">        Method of regridding. Passed to ``xesmf.Regridder``.</span>
<span class="sd">    weights_path : str, optional</span>
<span class="sd">        Local path to netCDF file of pre-calculated XESMF regridding weights.</span>
<span class="sd">    astype : str, numpy.dtype, or None, optional</span>
<span class="sd">        Typecode or data-type to which the regridded output is cast.</span>
<span class="sd">    add_cyclic : str, or None, optional</span>
<span class="sd">        Add cyclic point (aka wrap-around pixel) to given dimension before</span>
<span class="sd">        regridding. Useful for avoiding dateline artifacts along longitude</span>
<span class="sd">        in global datasets.</span>
<span class="sd">    keep_attrs : bool, optional</span>
<span class="sd">        Whether to pass attrs from input to regridded output.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xr.Dataset</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">add_cyclic</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">_add_cyclic</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">add_cyclic</span><span class="p">)</span>

    <span class="n">regridder</span> <span class="o">=</span> <span class="n">xe</span><span class="o">.</span><span class="n">Regridder</span><span class="p">(</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">domain</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">weights_path</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">astype</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">regridder</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="n">keep_attrs</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">astype</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">regridder</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="n">keep_attrs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>